<!doctype html><html lang=en class=no-js> <head><!-- Code from google optimiser --><script src="https://www.googleoptimize.com/optimize.js?id=OPT-M98W6LW"></script><!-- Code from Mouseflow --><script type=text/javascript>
      window._mfq = window._mfq || [];
      (function() {
        var mf = document.createElement("script");
        mf.type = "text/javascript"; mf.defer = true;
        mf.src = "//cdn.mouseflow.com/projects/7b4494c9-7974-49f0-9777-d14450db37e6.js";
        document.getElementsByTagName("head")[0].appendChild(mf);
      })();
    </script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Harsha's notes on data science"><meta name=author content="Harsha Achyuthuni"><link href=https://www.harshaash.com/Python/Blog%20validation/ rel=canonical><link rel=icon href=../../assets/images/logo.jpg><meta name=generator content="mkdocs-1.6.1, mkdocs-material-7.2.4"><title>LangGraphs - Data Science with Harsha</title><link rel=stylesheet href=../../assets/stylesheets/main.f7f47774.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.3f5d1f46.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style><link rel=stylesheet href=../../overrides/assets/stylesheets/user_defined.css><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-65034507-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script><script async src=https://www.google-analytics.com/analytics.js></script></head> <body dir=ltr data-md-color-scheme data-md-color-primary data-md-color-accent> <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script> <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer style="margin-bottom: 0;"></label> <div data-md-component=skip> <a href=#building-a-humanintheloop-editor-with-langgraph class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Data Science with Harsha" class="md-header__button md-logo" aria-label="Data Science with Harsha" data-md-component=logo> <img src=../../assets/images/logo.jpg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Data Science with Harsha </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> LangGraphs </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme data-md-color-primary data-md-color-accent aria-hidden=true type=radio name=__palette id=__palette_1> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M7 10a2 2 0 0 1 2 2 2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2m10-3a5 5 0 0 1 5 5 5 5 0 0 1-5 5H7a5 5 0 0 1-5-5 5 5 0 0 1 5-5h10M7 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3h10a3 3 0 0 0 3-3 3 3 0 0 0-3-3H7z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme data-md-color-primary data-md-color-accent aria-hidden=true type=radio name=__palette id=__palette_3> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=red data-md-color-accent=red aria-label="Switch to light mode" type=radio name=__palette id=__palette_4> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_3 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg> </label> </form> <a href=../../contact title="Contact Me" class=md-header__button aria-label="Contact Me" style="display: inline-flex; align-items: center; gap: 0.3rem; white-space: nowrap;"> <span class=md-icon style="display: inline-flex;"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m20 8-8 5-8-5V6l8 5 8-5m0-2H4c-1.11 0-2 .89-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2z"/></svg> </span> <span style="font-size: 0.8rem;">Contact Me</span> </a> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08z"/></svg> </a> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Data Science with Harsha" class="md-nav__button md-logo" aria-label="Data Science with Harsha" data-md-component=logo> <img src=../../assets/images/logo.jpg alt=logo> </a> Data Science with Harsha </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Home </a> </li> <li class=md-nav__item> <a href=../../resume/ class=md-nav__link> Resume </a> </li> <li class=md-nav__item> <a href=../../contact/ class=md-nav__link> Contact </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4> Blog <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Blog data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Blog </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Others/Table_of_Contents/ class=md-nav__link> Table of Contents </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_2 type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2> Visualization <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Visualization data-md-level=2> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Visualization </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Vizualisation%20using%20python%20Part%201/ class=md-nav__link> Vizualizing tabular data (Python) </a> </li> <li class=md-nav__item> <a href=../Visualization%20for%20predictive%20analytics/ class=md-nav__link> Vizualising for predictive analytics (Python) </a> </li> <li class=md-nav__item> <a href=../../R/Univariate-analysis/ class=md-nav__link> Univariate Analysis (R) </a> </li> <li class=md-nav__item> <a href=../../R/multivariateAnalysis/ class=md-nav__link> Multivariate Analysis (R) </a> </li> <li class=md-nav__item> <a href=../../R/multicollinearity/ class=md-nav__link> Multicollinearity (R) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3 type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3> Statistics basics <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Statistics basics" data-md-level=2> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> Statistics basics </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Statistics%20basics/ class=md-nav__link> Statistics Basics (Python) </a> </li> <li class=md-nav__item> <a href=../../R/Probability/ class=md-nav__link> Probability (R) </a> </li> <li class=md-nav__item> <a href=../../R/vectors/ class=md-nav__link> Vectors (R) </a> </li> <li class=md-nav__item> <a href=../../R/matrices/ class=md-nav__link> Matrices (R) </a> </li> <li class=md-nav__item> <a href=../Call%20center%20distributions/ class=md-nav__link> Call center distributions (Python) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_4 type=checkbox id=__nav_4_4> <label class=md-nav__link for=__nav_4_4> Hypothesis Testing <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Hypothesis Testing" data-md-level=2> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> Hypothesis Testing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../R/attendance_t_test/ class=md-nav__link> z-test and t-test (R) </a> </li> <li class=md-nav__item> <a href=../../R/anova/ class=md-nav__link> ANOVA Test (R) </a> </li> <li class=md-nav__item> <a href=../../R/chi-sq-goodness-of-fit/ class=md-nav__link> Chi-Square Goodness of fit (R) </a> </li> <li class=md-nav__item> <a href=../../R/chi-sq-test-of-independence/ class=md-nav__link> Chi-Square test of independence (R) </a> </li> <li class=md-nav__item> <a href=../Hypothesis_Testing_Python/ class=md-nav__link> Hypothesis testing using Python </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_5 type=checkbox id=__nav_4_5> <label class=md-nav__link for=__nav_4_5> Factor Analysis <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Factor Analysis" data-md-level=2> <label class=md-nav__title for=__nav_4_5> <span class="md-nav__icon md-icon"></span> Factor Analysis </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../R/Curse-of-Dimensionality/ class=md-nav__link> Curse of dimensionality </a> </li> <li class=md-nav__item> <a href=../../R/EFA/ class=md-nav__link> Exploratory factor analysis (R) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_6 type=checkbox id=__nav_4_6> <label class=md-nav__link for=__nav_4_6> Preprocessing data <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Preprocessing data" data-md-level=2> <label class=md-nav__title for=__nav_4_6> <span class="md-nav__icon md-icon"></span> Preprocessing data </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../R/KNN_Imputation/ class=md-nav__link> Null Value Imputation (R) </a> </li> <li class=md-nav__item> <a href=../Machine%20Learning%20Part%201/ class=md-nav__link> Feature engineering (Python) </a> </li> <li class=md-nav__item> <a href=../../R/Handling-Imbalanced-classes/ class=md-nav__link> Handling Imbalanced Classes </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_7 type=checkbox id=__nav_4_7> <label class=md-nav__link for=__nav_4_7> Prediction algorithms <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Prediction algorithms" data-md-level=2> <label class=md-nav__title for=__nav_4_7> <span class="md-nav__icon md-icon"></span> Prediction algorithms </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_7_1 type=checkbox id=__nav_4_7_1> <label class=md-nav__link for=__nav_4_7_1> Classification Algorithms <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Classification Algorithms" data-md-level=3> <label class=md-nav__title for=__nav_4_7_1> <span class="md-nav__icon md-icon"></span> Classification Algorithms </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../R/logistic-regression/ class=md-nav__link> Logistic Regression (R) </a> </li> <li class=md-nav__item> <a href=../../R/CHAID/ class=md-nav__link> CHAID Decision Trees (R) </a> </li> <li class=md-nav__item> <a href=../../R/CART-Classification/ class=md-nav__link> CART Classification (R) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_7_2 type=checkbox id=__nav_4_7_2> <label class=md-nav__link for=__nav_4_7_2> Regression Algorithms <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Regression Algorithms" data-md-level=3> <label class=md-nav__title for=__nav_4_7_2> <span class="md-nav__icon md-icon"></span> Regression Algorithms </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../R/part-and-partial-corr/ class=md-nav__link> Part and partial correlation </a> </li> <li class=md-nav__item> <a href=../../R/Linear-regression/ class=md-nav__link> Linear Regression (R) </a> </li> <li class=md-nav__item> <a href=../Linear%20regression%20usecase%20mpg%20prediction/ class=md-nav__link> Lasso and Ridge regression (Python) </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_8 type=checkbox id=__nav_4_8> <label class=md-nav__link for=__nav_4_8> Machine Learning <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Machine Learning" data-md-level=2> <label class=md-nav__title for=__nav_4_8> <span class="md-nav__icon md-icon"></span> Machine Learning </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=https://harshaachyuthuni.shinyapps.io/Machine_Learning/ class=md-nav__link> Interactive Machine Learning (RShiny) </a> </li> <li class=md-nav__item> <a href=../ML%20using%20scikit-learn/ class=md-nav__link> Multi models (Python) </a> </li> <li class=md-nav__item> <a href=../Explainable%20models%20using%20Heart%20Failure/ class=md-nav__link> Explainable ML (Python) </a> </li> <li class=md-nav__item> <a href=../Demonstrating%20online%20learning/ class=md-nav__link> Streaming Machine Learning (Python) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_9 type=checkbox id=__nav_4_9> <label class=md-nav__link for=__nav_4_9> Time Series forecasting <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Time Series forecasting" data-md-level=2> <label class=md-nav__title for=__nav_4_9> <span class="md-nav__icon md-icon"></span> Time Series forecasting </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../R/time-series/ class=md-nav__link> Introduction to stationarity (R) </a> </li> <li class=md-nav__item> <a href=../../R/Stationarity-tests/ class=md-nav__link> Stationary Tests (R) </a> </li> <li class=md-nav__item> <a href=../../R/ARIMA/ class=md-nav__link> ARIMA in R </a> </li> <li class=md-nav__item> <a href=../ARIMA%20Forecasting/ class=md-nav__link> ARIMA in Python </a> </li> <li class=md-nav__item> <a href=../../R/Seasonal-Time-Series/ class=md-nav__link> Seasonal time series (R) </a> </li> <li class=md-nav__item> <a href=../../R/VAR-models/ class=md-nav__link> VAR Models (R) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_10 type=checkbox id=__nav_4_10> <label class=md-nav__link for=__nav_4_10> Deep learning <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Deep learning" data-md-level=2> <label class=md-nav__title for=__nav_4_10> <span class="md-nav__icon md-icon"></span> Deep learning </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ANN-1/ class=md-nav__link> Perceptron </a> </li> <li class=md-nav__item> <a href=../Backpropagation/ class=md-nav__link> Backpropagation </a> </li> <li class=md-nav__item> <a href=../DNN/ class=md-nav__link> Tensorflow and Keras </a> </li> <li class=md-nav__item> <a href=../Time%20series%20deep%20learning/ class=md-nav__link> Time series (python) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_11 type=checkbox id=__nav_4_11 checked> <label class=md-nav__link for=__nav_4_11> Generative AI <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Generative AI" data-md-level=2> <label class=md-nav__title for=__nav_4_11> <span class="md-nav__icon md-icon"></span> Generative AI </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../LLM%20Tokenizers/ class=md-nav__link> LLM Tokenizers </a> </li> <li class=md-nav__item> <a href=../prompt_engineering_techniques/ class=md-nav__link> Prompt Engineering </a> </li> <li class=md-nav__item> <a href=../Agentic%20AI/ class=md-nav__link> Agentic AI </a> </li> <li class=md-nav__item> <a href=../RAG/ class=md-nav__link> RAG </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> LangGraphs <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> LangGraphs </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#quick-glossary class=md-nav__link> Quick glossary </a> </li> <li class=md-nav__item> <a href=#building-agentic-ai-tools-for-blog-editing class=md-nav__link> Building Agentic AI Tools for Blog Editing </a> <nav class=md-nav aria-label="Building Agentic AI Tools for Blog Editing"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#agent-1-extract-visible-text-from-markdownhtml class=md-nav__link> Agent 1: Extract visible text from Markdown/HTML </a> </li> <li class=md-nav__item> <a href=#agent-2-identify-text-issues-grammar-tone-clarity class=md-nav__link> Agent 2: Identify text issues (grammar, tone, clarity) </a> </li> <li class=md-nav__item> <a href=#agent-3-extract-code-pythonjsr-with-normalization class=md-nav__link> Agent 3: Extract code (Python/JS/R) with normalization </a> </li> <li class=md-nav__item> <a href=#agent-4-run-code-produce-minimal-change-suggestions-if-it-fails class=md-nav__link> Agent 4: Run code &amp; produce minimal change suggestions if it fails </a> </li> <li class=md-nav__item> <a href=#agent-5-apply-minimal-text-code-fixes-to-the-original-markdown class=md-nav__link> Agent 5: Apply minimal text &amp; code fixes to the original Markdown </a> </li> <li class=md-nav__item> <a href=#agent-6-validate-html-rendering-details class=md-nav__link> Agent 6: Validate HTML rendering details </a> </li> <li class=md-nav__item> <a href=#utility-diffs-for-review class=md-nav__link> Utility: Diffs for review </a> </li> <li class=md-nav__item> <a href=#router-input-decide-if-human-feedback-demands-more-changes class=md-nav__link> Router input: Decide if human feedback demands more changes </a> </li> <li class=md-nav__item> <a href=#agent-7-apply-the-humans-requested-changes class=md-nav__link> Agent 7: Apply the human’s requested changes </a> </li> <li class=md-nav__item> <a href=#persistence-save-the-final-html class=md-nav__link> Persistence: Save the final HTML </a> </li> <li class=md-nav__item> <a href=#the-state-typed-schema-aggregation-rules class=md-nav__link> The State: typed schema &amp; aggregation rules </a> </li> <li class=md-nav__item> <a href=#nodes-agents-as-pure-functions class=md-nav__link> Nodes (agents) as pure functions </a> </li> <li class=md-nav__item> <a href=#the-graph-wiring-nodes-conditional-edges-memory-and-breakpoints class=md-nav__link> The Graph: wiring nodes, conditional edges, memory, and breakpoints </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#run-the-workflow class=md-nav__link> Run the workflow </a> </li> <li class=md-nav__item> <a href=#conclusion class=md-nav__link> Conclusion </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../Others/yashoda_presentation/ class=md-nav__link> AI in Healthcare </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_12 type=checkbox id=__nav_4_12> <label class=md-nav__link for=__nav_4_12> Prescriptive Analytics <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Prescriptive Analytics" data-md-level=2> <label class=md-nav__title for=__nav_4_12> <span class="md-nav__icon md-icon"></span> Prescriptive Analytics </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../R/Linear-programming/ class=md-nav__link> Linear Programming (R) </a> </li> <li class=md-nav__item> <a href=../../Others/integer_programming_blog/ class=md-nav__link> Integer Programming tricks </a> </li> <li class=md-nav__item> <a href=../inventory_optimization_eoq_ortools/ class=md-nav__link> Inventory Optimisation (Python) </a> </li> <li class=md-nav__item> <a href=../../R/adoption_of_new_product/ class=md-nav__link> Adoption of new product (R) </a> </li> <li class=md-nav__item> <a href=../Diffusion%20on%20networks/ class=md-nav__link> Bass Forecasting model (Python) </a> </li> <li class=md-nav__item> <a href=../../Others/AHP/ class=md-nav__link> Analytic Hierarchy Process </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_13 type=checkbox id=__nav_4_13> <label class=md-nav__link for=__nav_4_13> Clustering <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Clustering data-md-level=2> <label class=md-nav__title for=__nav_4_13> <span class="md-nav__icon md-icon"></span> Clustering </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../R/hierarchical_clustering/ class=md-nav__link> Hierarchical Clustering </a> </li> <li class=md-nav__item> <a href=../../R/kMeansClustering/ class=md-nav__link> K-Means Clustering </a> </li> <li class=md-nav__item> <a href=../train_delays/ class=md-nav__link> DBSCAN Clustering (Python) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_14 type=checkbox id=__nav_4_14> <label class=md-nav__link for=__nav_4_14> Reinforcement Learning <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Reinforcement Learning" data-md-level=2> <label class=md-nav__title for=__nav_4_14> <span class="md-nav__icon md-icon"></span> Reinforcement Learning </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../R/CustomerLifetimeValue/ class=md-nav__link> Customer Lifetime Value </a> </li> <li class=md-nav__item> <a href=../../R/recommendation-systems/ class=md-nav__link> Recommendation Systems (R) </a> </li> <li class=md-nav__item> <a href=../Neural_collaborative_filtering/ class=md-nav__link> Collaborative Filtering (Python) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_15 type=checkbox id=__nav_4_15> <label class=md-nav__link for=__nav_4_15> Networks <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Networks data-md-level=2> <label class=md-nav__title for=__nav_4_15> <span class="md-nav__icon md-icon"></span> Networks </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Introduction%20to%20Networkx/ class=md-nav__link> Introduction to NetworkX (Python) </a> </li> <li class=md-nav__item> <a href=../Network%20Science/ class=md-nav__link> Network Science (Python) </a> </li> <li class=md-nav__item> <a href=../Network%20centrality/ class=md-nav__link> Network Centrality (Python) </a> </li> <li class=md-nav__item> <a href=../Shortest%20path%20problems/ class=md-nav__link> Shortest path using integer programming (Python) </a> </li> <li class=md-nav__item> <a href=../Network%20Flow%20problems/ class=md-nav__link> Network flow problems (Python) </a> </li> <li class=md-nav__item> <a href=../Community%20detection/ class=md-nav__link> Community detection (Python) </a> </li> <li class=md-nav__item> <a href=../Bipartite%20matching/ class=md-nav__link> Bipartite matching (Python) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_16 type=checkbox id=__nav_4_16> <label class=md-nav__link for=__nav_4_16> Deployment <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Deployment data-md-level=2> <label class=md-nav__title for=__nav_4_16> <span class="md-nav__icon md-icon"></span> Deployment </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Machine%20learning%20as%20HTTP%20Request/ class=md-nav__link> ML deployment in Flask (Python) </a> </li> <li class=md-nav__item> <a href=../Saving%20predictions%20in%20database/ class=md-nav__link> Handling databases using python </a> </li> <li class=md-nav__item> <a href=../ORM/ class=md-nav__link> ORM (Python) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_17 type=checkbox id=__nav_4_17> <label class=md-nav__link for=__nav_4_17> Career lessons <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Career lessons" data-md-level=2> <label class=md-nav__title for=__nav_4_17> <span class="md-nav__icon md-icon"></span> Career lessons </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Others/learnings/ class=md-nav__link> Learnings from failures </a> </li> <li class=md-nav__item> <a href=../../Others/podcast/ class=md-nav__link> Making ML Consumable </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_18 type=checkbox id=__nav_4_18> <label class=md-nav__link for=__nav_4_18> Higher education review <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Higher education review" data-md-level=2> <label class=md-nav__title for=__nav_4_18> <span class="md-nav__icon md-icon"></span> Higher education review </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Others/IIMB%20BAI/ class=md-nav__link> IIMB BAI </a> </li> <li class=md-nav__item> <a href=../../Others/part%20time%20data%20science%20masters/ class=md-nav__link> Part-time DS masters </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_19 type=checkbox id=__nav_4_19> <label class=md-nav__link for=__nav_4_19> External blogs <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="External blogs" data-md-level=2> <label class=md-nav__title for=__nav_4_19> <span class="md-nav__icon md-icon"></span> External blogs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Others/Imperial%20College%20London/ class=md-nav__link> Imperial college London </a> </li> <li class=md-nav__item> <a href=../../Others/Publications/ class=md-nav__link> Publications/conferences </a> </li> <li class=md-nav__item> <a href=../../Others/Deployed%20apps/ class=md-nav__link> Deployed apps </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_20 type=checkbox id=__nav_4_20> <label class=md-nav__link for=__nav_4_20> Projects <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Projects data-md-level=2> <label class=md-nav__title for=__nav_4_20> <span class="md-nav__icon md-icon"></span> Projects </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Others/preventive_maintainence/ class=md-nav__link> Preventive maintainence </a> </li> <li class=md-nav__item> <a href=../../Others/Contract%20Intelligence%20tool/ class=md-nav__link> Contract Intelligence </a> </li> <li class=md-nav__item> <a href=../../Others/competitor%20intelligence/ class=md-nav__link> Competitor intelligence </a> </li> <li class=md-nav__item> <a href=../../Others/quiz%20generation/ class=md-nav__link> Quiz Generation </a> </li> <li class=md-nav__item> <a href=../../Others/Scarecrow/ class=md-nav__link> Intelligent annotation </a> </li> <li class=md-nav__item> <a href=../../Others/Demand%20Forecasting/ class=md-nav__link> Demand Forecasting </a> </li> <li class=md-nav__item> <a href=../../Others/bid%20allocation%20model/ class=md-nav__link> Bid Allocation </a> </li> <li class=md-nav__item> <a href=../../Others/IIMB%20project/ class=md-nav__link> Reward and Recognition contests </a> </li> <li class=md-nav__item> <a href=../../Others/supply%20chain%20analytics/ class=md-nav__link> Supply chain analytics </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#quick-glossary class=md-nav__link> Quick glossary </a> </li> <li class=md-nav__item> <a href=#building-agentic-ai-tools-for-blog-editing class=md-nav__link> Building Agentic AI Tools for Blog Editing </a> <nav class=md-nav aria-label="Building Agentic AI Tools for Blog Editing"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#agent-1-extract-visible-text-from-markdownhtml class=md-nav__link> Agent 1: Extract visible text from Markdown/HTML </a> </li> <li class=md-nav__item> <a href=#agent-2-identify-text-issues-grammar-tone-clarity class=md-nav__link> Agent 2: Identify text issues (grammar, tone, clarity) </a> </li> <li class=md-nav__item> <a href=#agent-3-extract-code-pythonjsr-with-normalization class=md-nav__link> Agent 3: Extract code (Python/JS/R) with normalization </a> </li> <li class=md-nav__item> <a href=#agent-4-run-code-produce-minimal-change-suggestions-if-it-fails class=md-nav__link> Agent 4: Run code &amp; produce minimal change suggestions if it fails </a> </li> <li class=md-nav__item> <a href=#agent-5-apply-minimal-text-code-fixes-to-the-original-markdown class=md-nav__link> Agent 5: Apply minimal text &amp; code fixes to the original Markdown </a> </li> <li class=md-nav__item> <a href=#agent-6-validate-html-rendering-details class=md-nav__link> Agent 6: Validate HTML rendering details </a> </li> <li class=md-nav__item> <a href=#utility-diffs-for-review class=md-nav__link> Utility: Diffs for review </a> </li> <li class=md-nav__item> <a href=#router-input-decide-if-human-feedback-demands-more-changes class=md-nav__link> Router input: Decide if human feedback demands more changes </a> </li> <li class=md-nav__item> <a href=#agent-7-apply-the-humans-requested-changes class=md-nav__link> Agent 7: Apply the human’s requested changes </a> </li> <li class=md-nav__item> <a href=#persistence-save-the-final-html class=md-nav__link> Persistence: Save the final HTML </a> </li> <li class=md-nav__item> <a href=#the-state-typed-schema-aggregation-rules class=md-nav__link> The State: typed schema &amp; aggregation rules </a> </li> <li class=md-nav__item> <a href=#nodes-agents-as-pure-functions class=md-nav__link> Nodes (agents) as pure functions </a> </li> <li class=md-nav__item> <a href=#the-graph-wiring-nodes-conditional-edges-memory-and-breakpoints class=md-nav__link> The Graph: wiring nodes, conditional edges, memory, and breakpoints </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#run-the-workflow class=md-nav__link> Run the workflow </a> </li> <li class=md-nav__item> <a href=#conclusion class=md-nav__link> Conclusion </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=building-a-humanintheloop-editor-with-langgraph>Building a Human‑in‑the‑Loop Editor with LangGraph<a class=headerlink href=#building-a-humanintheloop-editor-with-langgraph title="Permanent link">&para;</a></h1> <p><strong>Agents, State, Routers, Map‑Reduce, Memory, and Breakpoints, explained with working code</strong></p> <p>I often need robust, auditable, and repeatable Gen AI pipelines. LangGraph, a graph-native orchestration library built on LangChain, provides this by modelling complex LLM workflows as stateful graphs. These graphs consist of agents (nodes) connected by edges, featuring conditional routing, memory checkpoints, and breakpoints for human review. In this blog, we will walk through a real pipeline that:<br> 1. Reads a Markdown blog.<br> 2. Extracts user-visible text and code.<br> 3. Diagnoses issues.<br> 4. Applies minimal fixes.<br> 5. Validates HTML rendering.<br> 6. Pauses for human feedback (a breakpoint).<br> 7. Routes to either apply changes or save the file.<br> 8. Persists state across runs. </p> <p>This is all implemented using LangGraph’s StateGraph, conditional edges, checkpointing, and interrupts, driven by LangChain prompts with ChatOpenAI. </p> <h2 id=quick-glossary>Quick glossary<a class=headerlink href=#quick-glossary title="Permanent link">&para;</a></h2> <ol> <li><strong>Agent (Node)</strong>: A function that has a single responsibility, such as extracting text or validating code. In LangGraph, nodes are agents. </li> <li><strong>Graph</strong>: A directed acyclic graph (DAG) of these nodes, where data flows along the edges. We build it with <code>StateGraph</code>. </li> <li><strong>State</strong>: A typed, mergeable record (our <code>AppState</code>) that holds inputs and outputs between nodes. Fields can specify aggregation semantics, such as <code>operator.add</code> to append lists. </li> <li><strong>Router / Conditional Node</strong>: A node with logic to branch conditionally. In our case, we route to <strong>Apply Feedback</strong> or <strong>Save HTML</strong> based on a function that returns 'True' or 'False'. </li> <li><strong>Map-Reduce</strong>: A pattern involving fanning out for parallel processing (e.g., text and code in parallel) and then fanning in to recombine the changes. </li> <li><strong>Memory / Checkpoints</strong>: The ability to persist state across runs (per <code>thread_id</code>) so we can resume, inspect, or time-travel. This is implemented via <code>MemorySaver</code>. </li> <li><strong>Breakpoints (Interrupts)</strong>: Points in the graph where execution pauses. Here, we pause just before “Human Feedback” to allow a person to inspect and adjust.</li> </ol> <h2 id=building-agentic-ai-tools-for-blog-editing>Building Agentic AI Tools for Blog Editing<a class=headerlink href=#building-agentic-ai-tools-for-blog-editing title="Permanent link">&para;</a></h2> <p>I want to build a tool to help edit my blog posts. Most of my posts are Markdown files containing text, code, images, and tables. This tool could be an Agentic AI system that: 1. <strong>Reads Markdown Files</strong>: Automatically processes blog posts written in Markdown.<br> 2. <strong>Identifies and Corrects Issues</strong>:<br> - <strong>Grammar and Spelling</strong>: Detects and corrects grammatical errors and misspellings.<br> - <strong>Code Verification</strong>: Analyses and executes code snippets within the blog posts to identify potential issues and suggest improvements. 3. <strong>Provides Edited Output</strong>: Generates an edited version of the blog post with corrections applied.</p> <p>LangSmith Flow:<br> <img alt=image.png src=4200480b-3a55-446c-bc4e-56d4298eb6a8.png></p> <div class=highlight><pre><span></span><code><span class=kn>import</span><span class=w> </span><span class=nn>re</span>
<span class=kn>import</span><span class=w> </span><span class=nn>difflib</span>
<span class=kn>import</span><span class=w> </span><span class=nn>operator</span>
<span class=kn>import</span><span class=w> </span><span class=nn>json</span>
<span class=kn>from</span><span class=w> </span><span class=nn>typing</span><span class=w> </span><span class=kn>import</span> <span class=n>List</span><span class=p>,</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Any</span><span class=p>,</span> <span class=n>TypedDict</span>
<span class=kn>from</span><span class=w> </span><span class=nn>typing_extensions</span><span class=w> </span><span class=kn>import</span> <span class=n>Annotated</span><span class=p>,</span> <span class=n>Literal</span>

<span class=kn>from</span><span class=w> </span><span class=nn>langgraph.graph</span><span class=w> </span><span class=kn>import</span> <span class=n>StateGraph</span><span class=p>,</span> <span class=n>END</span>
<span class=kn>from</span><span class=w> </span><span class=nn>langchain_core.prompts</span><span class=w> </span><span class=kn>import</span> <span class=n>ChatPromptTemplate</span>
<span class=kn>from</span><span class=w> </span><span class=nn>langchain_core.output_parsers</span><span class=w> </span><span class=kn>import</span> <span class=n>JsonOutputParser</span>
<span class=kn>from</span><span class=w> </span><span class=nn>langgraph.checkpoint.memory</span><span class=w> </span><span class=kn>import</span> <span class=n>MemorySaver</span>
<span class=kn>from</span><span class=w> </span><span class=nn>langchain_openai</span><span class=w> </span><span class=kn>import</span> <span class=n>ChatOpenAI</span>
</code></pre></div> <p>Environment helper to read API key at runtime</p> <div class=highlight><pre><span></span><code><span class=kn>import</span><span class=w> </span><span class=nn>os</span><span class=o>,</span><span class=w> </span><span class=nn>getpass</span>

<span class=k>def</span><span class=w> </span><span class=nf>_set_env</span><span class=p>(</span><span class=n>var</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>var</span><span class=p>):</span>
        <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=n>var</span><span class=p>]</span> <span class=o>=</span> <span class=n>getpass</span><span class=o>.</span><span class=n>getpass</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>var</span><span class=si>}</span><span class=s2>: &quot;</span><span class=p>)</span>

<span class=n>_set_env</span><span class=p>(</span><span class=s2>&quot;OPENAI_API_KEY&quot;</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=kn>from</span><span class=w> </span><span class=nn>langchain_openai</span><span class=w> </span><span class=kn>import</span> <span class=n>ChatOpenAI</span>
<span class=n>llm</span> <span class=o>=</span> <span class=n>ChatOpenAI</span><span class=p>(</span><span class=n>model</span><span class=o>=</span><span class=s2>&quot;gpt-4o&quot;</span><span class=p>,</span> <span class=n>temperature</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span> 
</code></pre></div> <p>We load Markdown and pre-render it to HTML to ensure that text extraction reflects what a user will actually see.</p> <div class=highlight><pre><span></span><code><span class=kn>import</span><span class=w> </span><span class=nn>markdown</span>
<span class=k>def</span><span class=w> </span><span class=nf>read_file</span><span class=p>(</span><span class=n>file_name</span><span class=p>:</span><span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&#39;&#39;&#39;</span>
<span class=sd>    Reads file given file_name</span>
<span class=sd>    &#39;&#39;&#39;</span>
    <span class=n>f</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_name</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>)</span>
    <span class=n>fileString</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
    <span class=n>htmlmarkdown</span><span class=o>=</span><span class=n>markdown</span><span class=o>.</span><span class=n>markdown</span><span class=p>(</span><span class=n>fileString</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>htmlmarkdown</span>
</code></pre></div> <h3 id=agent-1-extract-visible-text-from-markdownhtml>Agent 1: Extract visible text from Markdown/HTML<a class=headerlink href=#agent-1-extract-visible-text-from-markdownhtml title="Permanent link">&para;</a></h3> <p>This agent enforces a strict JSON schema. It extracts only user-visible text (no HTML tags, no code except comments).</p> <div class=highlight><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>extract_text</span><span class=p>(</span><span class=n>markdown</span><span class=p>:</span><span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]]:</span>
<span class=w>    </span><span class=sd>&#39;&#39;&#39;</span>
<span class=sd>    Extract text from the markdown</span>
<span class=sd>    &#39;&#39;&#39;</span>    
    <span class=n>extract_text_prompt</span> <span class=o>=</span> <span class=n>ChatPromptTemplate</span><span class=o>.</span><span class=n>from_messages</span><span class=p>([</span>
        <span class=p>(</span><span class=s2>&quot;system&quot;</span><span class=p>,</span>
<span class=w>         </span><span class=sd>&#39;&#39;&#39;You are a precise text extractor for Markdown/HTML content.</span>
<span class=sd>          Extract only user-visible text that renders after Markdown is converted to HTML.</span>
<span class=sd>          Ignore raw tags and attributes. Preserve order. Output strictly valid JSON.&#39;&#39;&#39;</span><span class=p>),</span>
        <span class=p>(</span><span class=s2>&quot;system&quot;</span><span class=p>,</span>
<span class=w>         </span><span class=sd>&#39;&#39;&#39;Sources of text:</span>
<span class=sd>         - &#39;header&#39;: from headings (&lt;h1&gt;..&lt;/h1&gt;, &lt;h2&gt;..&lt;/h2&gt;, &#39;#&#39;, &#39;##&#39;).</span>
<span class=sd>         - &#39;text&#39;: normal paragraphs, lists, blockquotes, table cell text, captions, etc.</span>
<span class=sd>         - &#39;comment&#39;: comments inside code blocks (Python &#39;#&#39;)&#39;&#39;&#39;</span><span class=p>),</span>
        <span class=p>(</span><span class=s2>&quot;system&quot;</span><span class=p>,</span>
<span class=w>         </span><span class=sd>&#39;&#39;&#39;Rules:</span>
<span class=sd>         1) Do NOT include HTML tags; only visible text.</span>
<span class=sd>         2) Do NOT fabricate text; if empty, return [].</span>
<span class=sd>         3) Preserve top-to-bottom order.</span>
<span class=sd>         4) Trim whitespace; keep meaningful line breaks.</span>
<span class=sd>         5) Code blocks: extract only comments as &#39;comment&#39;; exclude code.</span>
<span class=sd>         6) Images/links: include visible alt/link text as &#39;text&#39; if present.</span>
<span class=sd>         7) Headings: use &#39;header&#39;; normalize to one line.</span>
<span class=sd>         8) Paragraphs: use &#39;text&#39;.</span>
<span class=sd>         9) Output MUST be valid JSON list where each element has exactly one key among &#39;header&#39;,&#39;text&#39;,&#39;comment&#39;.</span>
<span class=sd>         10) Keep complete table and complete list in one single &#39;text&#39; block.</span>
<span class=sd>         &#39;&#39;&#39;</span><span class=p>),</span>
        <span class=p>(</span><span class=s2>&quot;system&quot;</span><span class=p>,</span>
<span class=w>         </span><span class=sd>&#39;&#39;&#39;Output schema example:</span>
<span class=sd>         [</span>
<span class=sd>          {{&quot;header&quot;: &quot;Title of the document&quot;}},</span>
<span class=sd>          {{&quot;text&quot;: &quot;Introductory paragraph...&quot;}},</span>
<span class=sd>          {{&quot;comment&quot;: &quot;This function adds two numbers&quot;}},</span>
<span class=sd>          {{&quot;text&quot;: &quot;Another paragraph or bullet text...&quot;}}</span>
<span class=sd>         ]&#39;&#39;&#39;</span><span class=p>),</span>
        <span class=p>(</span><span class=s2>&quot;human&quot;</span><span class=p>,</span>
<span class=w>         </span><span class=sd>&#39;&#39;&#39;</span>
<span class=sd>         Input markdown:</span>
<span class=sd>         ---------------</span>
<span class=sd>         {markdown}</span>
<span class=sd>         ---------------</span>
<span class=sd>         Return ONLY the JSON list described above. No explanations—just JSON.&#39;&#39;&#39;</span><span class=p>)</span>
    <span class=p>])</span>
    <span class=n>resp</span> <span class=o>=</span> <span class=n>llm</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span><span class=n>extract_text_prompt</span><span class=o>.</span><span class=n>format_messages</span><span class=p>(</span><span class=n>markdown</span><span class=o>=</span><span class=n>markdown</span><span class=p>))</span>
    <span class=k>try</span><span class=p>:</span>
        <span class=k>return</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>resp</span><span class=o>.</span><span class=n>content</span><span class=p>)</span>
    <span class=k>except</span><span class=p>:</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=n>json_parser</span> <span class=o>=</span> <span class=n>JsonOutputParser</span><span class=p>()</span>
            <span class=k>return</span> <span class=n>json_parser</span><span class=o>.</span><span class=n>parse</span><span class=p>(</span><span class=n>resp</span><span class=o>.</span><span class=n>content</span><span class=p>)</span>
        <span class=k>except</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Failed to parse the JSON&quot;</span><span class=p>)</span>
</code></pre></div> <h3 id=agent-2-identify-text-issues-grammar-tone-clarity>Agent 2: Identify text issues (grammar, tone, clarity)<a class=headerlink href=#agent-2-identify-text-issues-grammar-tone-clarity title="Permanent link">&para;</a></h3> <p>This agent performs diagnostics on the extracted text and returns minimal, actionable fixes rather than full rewrites. </p> <div class=highlight><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>identify_text_issues</span><span class=p>(</span><span class=n>text_extracts</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]])</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]]:</span>
<span class=w>    </span><span class=sd>&#39;&#39;&#39;</span>
<span class=sd>    Identify issues within the text</span>
<span class=sd>    &#39;&#39;&#39;</span>    
    <span class=n>identify_text_issues_prompt</span> <span class=o>=</span> <span class=n>ChatPromptTemplate</span><span class=o>.</span><span class=n>from_messages</span><span class=p>([</span>
        <span class=p>(</span><span class=s2>&quot;system&quot;</span><span class=p>,</span>
<span class=w>         </span><span class=sd>&#39;&#39;&#39;</span>
<span class=sd>        You are a grammar and text quality evaluator for a data science blog.</span>
<span class=sd>        Your task:</span>
<span class=sd>        - Review extracted text blocks for grammar, spelling, tone, clarity, and consistency.</span>
<span class=sd>        - Prioritize UK English for spelling and style.</span>
<span class=sd>        - Identify issues and suggest minimal, actionable fixes (not full rewrites).</span>
<span class=sd>        - Do NOT fabricate issues; only return the response for texts that have issues.</span>
<span class=sd>        The text is in sequential order in the form</span>
<span class=sd>        [</span>
<span class=sd>          {{&quot;header&quot;: &quot;Title of the document&quot;}},</span>
<span class=sd>          {{&quot;text&quot;: &quot;Introductory paragraph...&quot;}},</span>
<span class=sd>          {{&quot;comment&quot;: &quot;This function adds two numbers&quot;}},</span>
<span class=sd>          {{&quot;text&quot;: &quot;Another paragraph or bullet text...&quot;}}</span>
<span class=sd>        ]</span>

<span class=sd>        Rules:</span>
<span class=sd>        1. Preserve the original text as the key in the output.</span>
<span class=sd>        2. For each problematic text block, provide a short description of the issue and suggested fix.</span>
<span class=sd>        3. Provide example with minimal changes that can fix the text.  </span>
<span class=sd>        4. If multiple issues exist for the same block, combine them into one concise string.</span>
<span class=sd>        5. Output MUST be valid JSON list of objects: [{{ &quot;&lt;original_text&gt;&quot;: &quot;&lt;issue description&gt;&quot; }}, ...].</span>
<span class=sd>        6. If no issues found, return [].</span>
<span class=sd>        7. Do NOT include explanations outside JSON.</span>
<span class=sd>        &#39;&#39;&#39;</span><span class=p>),</span>
        <span class=p>(</span><span class=s2>&quot;system&quot;</span><span class=p>,</span>
<span class=w>         </span><span class=sd>&#39;&#39;&#39;Output schema example:</span>
<span class=sd>         [</span>
<span class=sd>          {{&quot;Title of the document&quot;:&quot;Spelling mistake for tite -&gt; title }},</span>
<span class=sd>          {{&quot;Introductory paragraph...&quot;: &quot;Tone should be changed, example:...&quot;}}</span>
<span class=sd>         ]&#39;&#39;&#39;</span><span class=p>),</span>
        <span class=p>(</span><span class=s2>&quot;human&quot;</span><span class=p>,</span>
<span class=w>         </span><span class=sd>&#39;&#39;&#39;</span>
<span class=sd>         Extracted text:</span>
<span class=sd>         ---------------</span>
<span class=sd>         {extracted_text}</span>
<span class=sd>         ---------------</span>
<span class=sd>         Return ONLY the JSON list described above. No explanations—just JSON.&#39;&#39;&#39;</span><span class=p>)</span>
    <span class=p>])</span>

    <span class=n>resp</span> <span class=o>=</span> <span class=n>llm</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span><span class=n>identify_text_issues_prompt</span><span class=o>.</span><span class=n>format_messages</span><span class=p>(</span><span class=n>extracted_text</span><span class=o>=</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>text_extracts</span><span class=p>)))</span>
    <span class=k>try</span><span class=p>:</span>
        <span class=k>return</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>resp</span><span class=o>.</span><span class=n>content</span><span class=p>)</span>
    <span class=k>except</span><span class=p>:</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=n>json_parser</span> <span class=o>=</span> <span class=n>JsonOutputParser</span><span class=p>()</span>
            <span class=k>return</span> <span class=n>json_parser</span><span class=o>.</span><span class=n>parse</span><span class=p>(</span><span class=n>resp</span><span class=o>.</span><span class=n>content</span><span class=p>)</span>
        <span class=k>except</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Failed to parse the JSON&quot;</span><span class=p>)</span>
</code></pre></div> <h3 id=agent-3-extract-code-pythonjsr-with-normalization>Agent 3: Extract code (Python/JS/R) with normalization<a class=headerlink href=#agent-3-extract-code-pythonjsr-with-normalization title="Permanent link">&para;</a></h3> <p>We isolate executable code for later validation. The prompt de-dents, trims, and concatenates snippets by language.</p> <div class=highlight><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>extract_code</span><span class=p>(</span><span class=n>markdown</span><span class=p>:</span><span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=n>Literal</span><span class=p>[</span><span class=s1>&#39;python&#39;</span><span class=p>,</span> <span class=s1>&#39;javascript&#39;</span><span class=p>,</span> <span class=s1>&#39;R&#39;</span><span class=p>],</span> <span class=nb>str</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Extract code from Markdown/HTML and return a dict with keys &#39;python&#39;, &#39;javascript&#39;, &#39;R&#39;.</span>
<span class=sd>    Values contain concatenated code snippets in original order for each language.</span>
<span class=sd>    If a language is absent, return an empty string for that key.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=n>extract_text_prompt</span> <span class=o>=</span> <span class=n>ChatPromptTemplate</span><span class=o>.</span><span class=n>from_messages</span><span class=p>([</span>
        <span class=p>(</span><span class=s2>&quot;system&quot;</span><span class=p>,</span>
<span class=w>         </span><span class=sd>&#39;&#39;&#39;You are a precise code extractor and normalizer for Markdown/HTML.</span>
<span class=sd>         &#39;&#39;&#39;</span><span class=p>),</span>
        <span class=p>(</span><span class=s2>&quot;system&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Extract only executable source code for Python, JavaScript, and R from the input.</span>
<span class=sd>        Return a single JSON OBJECT (not a list) with exactly these keys:</span>
<span class=sd>        {{&quot;python&quot;: &quot;...&quot;, &quot;javascript&quot;: &quot;...&quot;, &quot;R&quot;: &quot;...&quot;}}.</span>
<span class=sd>        Concatenate multiple snippets per language in the original top-to-bottom order.</span>

<span class=sd>        Sources of code:</span>
<span class=sd>        - Python: fenced blocks ```python ...``` or ```py ...```.</span>
<span class=sd>        - R: fenced blocks ```r ...```.</span>
<span class=sd>        - JavaScript: fenced blocks ```javascript ...``` or &lt;script ...&gt; ... &lt;/script&gt; tags.</span>
<span class=sd>        Ignore inline code in single backticks.</span>

<span class=sd>        Normalization rules:</span>
<span class=sd>        1) Keep ONLY code, not outputs/results or rendered tables/images.</span>
<span class=sd>        2) For Python, remove REPL prompts: leading &quot;&gt;&gt;&gt; &quot; and &quot;... &quot;. Also remove lines starting with &quot;In [n]:&quot; or &quot;Out[n]:&quot;.</span>
<span class=sd>        3) Dedent each snippet, trim trailing spaces, ensure a trailing newline.</span>
<span class=sd>        4) Preserve original snippet order when concatenating per language.</span>
<span class=sd>        5) If a language has no code, use an empty string for its value.</span>
<span class=sd>        6) Optional import hoisting:</span>
<span class=sd>           - Python: move `import ...` / `from ... import ...` lines to the top of the Python value.</span>
<span class=sd>           - R: move `library(pkg)` calls to the top.</span>
<span class=sd>           - JavaScript: move `import ... from &#39;pkg&#39;` and `require(&#39;pkg&#39;)` to the top.</span>
<span class=sd>        7) Do NOT add commentary or markdown fences. Output MUST be only the JSON object.</span>

<span class=sd>        Output examples:</span>
<span class=sd>        {{</span>
<span class=sd>          &quot;python&quot;: &quot;import os\nprint(os.getcwd())\n# --- next snippet ---\n...&quot;,</span>
<span class=sd>          &quot;javascript&quot;: &quot;console.log(&#39;Hello&#39;);\n&quot;,</span>
<span class=sd>          &quot;R&quot;: &quot;library(ggplot2)\nx &lt;- 1:10\n&quot;</span>
<span class=sd>        }}</span>
<span class=sd>         &quot;&quot;&quot;</span><span class=p>),</span>
        <span class=p>(</span><span class=s2>&quot;human&quot;</span><span class=p>,</span>
<span class=w>         </span><span class=sd>&#39;&#39;&#39;</span>
<span class=sd>         Input markdown:</span>
<span class=sd>         ---------------</span>
<span class=sd>         {markdown}</span>
<span class=sd>         ---------------</span>
<span class=sd>         Return ONLY the JSON OBJECT described above. No explanations or fenced blocks, just JSON WITHOUT ```.&#39;&#39;&#39;</span><span class=p>)</span>
    <span class=p>])</span>
    <span class=n>resp</span> <span class=o>=</span> <span class=n>llm</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span><span class=n>extract_text_prompt</span><span class=o>.</span><span class=n>format_messages</span><span class=p>(</span><span class=n>markdown</span><span class=o>=</span><span class=n>markdown</span><span class=p>))</span>
    <span class=k>try</span><span class=p>:</span>
        <span class=k>return</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>resp</span><span class=o>.</span><span class=n>content</span><span class=p>)</span>
    <span class=k>except</span><span class=p>:</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=n>json_parser</span> <span class=o>=</span> <span class=n>JsonOutputParser</span><span class=p>()</span>
            <span class=k>return</span> <span class=n>json_parser</span><span class=o>.</span><span class=n>parse</span><span class=p>(</span><span class=n>resp</span><span class=o>.</span><span class=n>content</span><span class=p>)</span>
        <span class=k>except</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Failed to parse the JSON&quot;</span><span class=p>)</span>
</code></pre></div> <h3 id=agent-4-run-code-produce-minimal-change-suggestions-if-it-fails>Agent 4: Run code &amp; produce minimal change suggestions if it fails<a class=headerlink href=#agent-4-run-code-produce-minimal-change-suggestions-if-it-fails title="Permanent link">&para;</a></h3> <p>This agent attempts to execute Python code. If it fails, it asks the LLM to propose minimal fixes with diff-style explanations.</p> <div class=highlight><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>run_code</span><span class=p>(</span><span class=n>extracted_code</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=n>Literal</span><span class=p>[</span><span class=s1>&#39;python&#39;</span><span class=p>,</span> <span class=s1>&#39;javascript&#39;</span><span class=p>,</span> <span class=s1>&#39;R&#39;</span><span class=p>],</span> <span class=nb>str</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]]:</span>
    <span class=k>try</span><span class=p>:</span>
        <span class=n>exec</span><span class=p>(</span><span class=n>extracted_code</span><span class=p>[</span><span class=s1>&#39;python&#39;</span><span class=p>])</span>
        <span class=k>return</span> <span class=p>[{</span><span class=s1>&#39;python&#39;</span><span class=p>:</span><span class=s1>&#39;No changes to python code&#39;</span><span class=p>}]</span>
    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
        <span class=n>prompt</span> <span class=o>=</span> <span class=s2>&quot;&quot;&quot;</span>
<span class=s2>        I have a code which worked sometime back but is not working now. The code and error are shared.  </span>
<span class=s2>        Is this issue due to data not being present: If so, validate the code and try to see if there are any depreciated functions.  </span>
<span class=s2>        Is this issue due to a missing or depriciated variable: If so rewrite the depriciated code. Try making minimal changes to the code.  </span>
<span class=s2>        Return the change that you did in simple english with sample code and original code so that someone else who will read this will understand how to update the code.  </span>
<span class=s2>        Do as many minimal changes as possible. If no fixes are found, or you find any other error, return &quot;No changes to python code&quot;.</span>
<span class=s2>        Code: &quot;&quot;&quot;</span><span class=o>+</span> <span class=n>extracted_code</span><span class=p>[</span><span class=s1>&#39;python&#39;</span><span class=p>]</span> <span class=o>+</span><span class=s2>&quot;&quot;&quot;</span><span class=se>\n</span>
<span class=s2>        Error: &quot;&quot;&quot;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span>
    <span class=n>resp</span> <span class=o>=</span> <span class=n>llm</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span><span class=n>prompt</span><span class=p>)</span>
    <span class=n>output</span> <span class=o>=</span> <span class=n>resp</span><span class=o>.</span><span class=n>content</span>
    <span class=k>return</span> <span class=p>[{</span><span class=s1>&#39;python&#39;</span><span class=p>:</span><span class=n>output</span><span class=p>}]</span>
</code></pre></div> <h3 id=agent-5-apply-minimal-text-code-fixes-to-the-original-markdown>Agent 5: Apply minimal text &amp; code fixes to the original Markdown<a class=headerlink href=#agent-5-apply-minimal-text-code-fixes-to-the-original-markdown title="Permanent link">&para;</a></h3> <p>This agent recombines the parallel outputs (text and code fixes) and applies minimal edits. This "fan-in" step is the "Reduce" in our map-reduce pattern.</p> <div class=highlight><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>change_markdown</span><span class=p>(</span><span class=n>text_issues</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]],</span> <span class=n>code_issues</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]],</span> <span class=n>original_markdown</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Modify the original markdown file based on the issues found.</span>
<span class=sd>    Applies minimal changes as suggested by expert comments.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=n>fix_issues_prompt</span> <span class=o>=</span> <span class=n>ChatPromptTemplate</span><span class=o>.</span><span class=n>from_messages</span><span class=p>([</span>
        <span class=p>(</span><span class=s2>&quot;system&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;You are a grammar and text quality fixer for a data science blog.</span>

<span class=sd>        Your task:</span>
<span class=sd>        - Apply the expert&#39;s suggested fixes to the original Markdown.</span>
<span class=sd>        - Changes must be minimal: correct grammar, spelling, tone, and clarity ONLY where issues were flagged.</span>
<span class=sd>        - Do NOT rewrite entire sentences unless necessary.</span>
<span class=sd>        - Preserve:</span>
<span class=sd>          * Markdown structure (headings, lists, tables)</span>
<span class=sd>          * Code blocks and syntax (except for code changes and any changes to the code comments if provided)</span>
<span class=sd>          * Hyperlinks, images, and HTML tags</span>
<span class=sd>        - Do NOT add new content or explanations.</span>
<span class=sd>        - Output MUST be the full corrected Markdown document only, without any extra text or code fences.</span>
<span class=sd>        &quot;&quot;&quot;</span><span class=p>),</span>
        <span class=p>(</span><span class=s2>&quot;system&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Input details:</span>
<span class=sd>        - Issues are provided as a JSON list of objects: [{{ &quot;&lt;original_text&gt;&quot;: &quot;&lt;issue description&gt;&quot; }}, ...].</span>
<span class=sd>        - Original Markdown follows after the delimiter.</span>
<span class=sd>        &quot;&quot;&quot;</span><span class=p>),</span>
        <span class=p>(</span><span class=s2>&quot;human&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Expert comments on text:</span>
<span class=sd>        {text_issues}</span>

<span class=sd>        Expert comments on code:</span>
<span class=sd>        {code_issues}</span>
<span class=sd>        Original Markdown:</span>
<span class=sd>        -------</span>
<span class=sd>        {markdown}</span>
<span class=sd>        -------</span>

<span class=sd>        Return ONLY the corrected Markdown. Do NOT include ```markdown fences or any commentary.&quot;&quot;&quot;</span><span class=p>)</span>
    <span class=p>])</span>

    <span class=c1># Prepare prompt</span>
    <span class=n>messages</span> <span class=o>=</span> <span class=n>fix_issues_prompt</span><span class=o>.</span><span class=n>format_messages</span><span class=p>(</span>
        <span class=n>text_issues</span><span class=o>=</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>text_issues</span><span class=p>,</span> <span class=n>ensure_ascii</span><span class=o>=</span><span class=kc>False</span><span class=p>),</span>
        <span class=n>code_issues</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>code_issues</span><span class=p>,</span> <span class=n>ensure_ascii</span><span class=o>=</span><span class=kc>False</span><span class=p>),</span>
        <span class=n>markdown</span><span class=o>=</span><span class=n>original_markdown</span>
    <span class=p>)</span>

    <span class=c1># Invoke LLM</span>
    <span class=n>resp</span> <span class=o>=</span> <span class=n>llm</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span><span class=n>messages</span><span class=p>)</span>
    <span class=n>output</span> <span class=o>=</span> <span class=n>resp</span><span class=o>.</span><span class=n>content</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>

    <span class=c1># Cleanup: Remove accidental markdown fences or explanations</span>
    <span class=n>output</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s2>&quot;^```(?:markdown)?\s*&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>output</span><span class=p>)</span>
    <span class=n>output</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s2>&quot;\s*```$&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>output</span><span class=p>)</span>

    <span class=c1># Validate: Ensure output is not empty and contains original structure</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>output</span> <span class=ow>or</span> <span class=nb>len</span><span class=p>(</span><span class=n>output</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>10</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Model returned empty or invalid markdown.&quot;</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>output</span>
</code></pre></div> <h3 id=agent-6-validate-html-rendering-details>Agent 6: Validate HTML rendering details<a class=headerlink href=#agent-6-validate-html-rendering-details title="Permanent link">&para;</a></h3> <p>We make render-aware adjustments, such as for math delimiters and bullet spacing, while preserving content and code fences.</p> <div class=highlight><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>validate_html</span><span class=p>(</span><span class=n>new_markdown</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Check for html issues, spacing issues, broken links, markdown issues etc to validate the html content in the file.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>validate_html_prompt</span> <span class=o>=</span> <span class=n>ChatPromptTemplate</span><span class=o>.</span><span class=n>from_messages</span><span class=p>([</span>
        <span class=p>(</span><span class=s2>&quot;system&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;You are a html validator and fixer for a markdown to be converted to a html. </span>
<span class=sd>        You evaluate if the markdown file an render properly as a HTML and provide corrections if needed.</span>

<span class=sd>        Your task:</span>
<span class=sd>        - Identify any potential issues that might arise due to markdown being converted to html file such as:</span>
<span class=sd>            * Spaces: Two spaces after every bullet point and paragraph to ensure new line</span>
<span class=sd>            * Formula: $$ .. $$ indicates formula in new line, and has to have space after first $$ and before second $$ for it to render as a formula.</span>
<span class=sd>        - Identify html issues such as closing tags, etc.</span>
<span class=sd>        - Identify header levels and if they make sence: &lt;h1&gt; followed by &lt;h2&gt; and so on. Headers can also be also be represented as #, ##</span>
<span class=sd>        - Changes must be minimal and html related (or spaces): correct ONLY where issues were flagged.</span>
<span class=sd>        - Preserve:</span>
<span class=sd>          * Text</span>
<span class=sd>          * Code blocks and syntax</span>
<span class=sd>          * Formula blocks (except for adding spaces at the start or end if needed)</span>
<span class=sd>        - Do NOT add new content or explanations.</span>
<span class=sd>        - Output MUST be the full corrected Markdown document only, without any extra text or code fences.</span>
<span class=sd>        &quot;&quot;&quot;</span><span class=p>),</span>
        <span class=p>(</span><span class=s2>&quot;human&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Original Markdown:</span>
<span class=sd>        -------</span>
<span class=sd>        {markdown}</span>
<span class=sd>        -------</span>

<span class=sd>        Return ONLY the corrected Markdown. Do NOT include ```markdown fences or any commentary.&quot;&quot;&quot;</span><span class=p>)</span>
    <span class=p>])</span>

    <span class=c1># Prepare prompt</span>
    <span class=n>messages</span> <span class=o>=</span> <span class=n>validate_html_prompt</span><span class=o>.</span><span class=n>format_messages</span><span class=p>(</span>
        <span class=n>markdown</span><span class=o>=</span><span class=n>new_markdown</span>
    <span class=p>)</span>

    <span class=c1># Invoke LLM</span>
    <span class=n>resp</span> <span class=o>=</span> <span class=n>llm</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span><span class=n>messages</span><span class=p>)</span>
    <span class=n>output</span> <span class=o>=</span> <span class=n>resp</span><span class=o>.</span><span class=n>content</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>

    <span class=c1># Cleanup: Remove accidental markdown fences or explanations</span>
    <span class=n>output</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s2>&quot;^```(?:markdown)?\s*&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>output</span><span class=p>)</span>
    <span class=n>output</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s2>&quot;\s*```$&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>output</span><span class=p>)</span>

    <span class=c1># Validate: Ensure output is not empty and contains original structure</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>output</span> <span class=ow>or</span> <span class=nb>len</span><span class=p>(</span><span class=n>output</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>10</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Model returned empty or invalid markdown.&quot;</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>output</span>
</code></pre></div> <h3 id=utility-diffs-for-review>Utility: Diffs for review<a class=headerlink href=#utility-diffs-for-review title="Permanent link">&para;</a></h3> <p>These helpers produce colour-coded diffs so that reviewers can quickly see minimal changes.</p> <div class=highlight><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>print_comparision</span><span class=p>(</span><span class=n>m</span><span class=p>,</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>):</span>
    <span class=n>red</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=se>\033</span><span class=s2>[31m&quot;</span>
    <span class=n>green</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=se>\033</span><span class=s2>[32m&quot;</span>
    <span class=n>blue</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=se>\033</span><span class=s2>[34m&quot;</span>
    <span class=n>reset</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=se>\033</span><span class=s2>[39m&quot;</span>
    <span class=k>for</span> <span class=n>tag</span><span class=p>,</span> <span class=n>i1</span><span class=p>,</span> <span class=n>i2</span><span class=p>,</span> <span class=n>j1</span><span class=p>,</span> <span class=n>j2</span> <span class=ow>in</span> <span class=n>m</span><span class=o>.</span><span class=n>get_opcodes</span><span class=p>():</span>
        <span class=k>if</span> <span class=n>tag</span> <span class=o>==</span> <span class=s1>&#39;replace&#39;</span><span class=p>:</span>
            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=n>red</span><span class=si>}{</span><span class=n>a</span><span class=p>[</span><span class=n>i1</span><span class=p>:</span><span class=n>i2</span><span class=p>]</span><span class=si>}{</span><span class=n>reset</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>end</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>)</span>
            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=n>green</span><span class=si>}{</span><span class=n>b</span><span class=p>[</span><span class=n>j1</span><span class=p>:</span><span class=n>j2</span><span class=p>]</span><span class=si>}{</span><span class=n>reset</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>end</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>tag</span> <span class=o>==</span> <span class=s1>&#39;delete&#39;</span><span class=p>:</span>
            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=n>red</span><span class=si>}{</span><span class=n>a</span><span class=p>[</span><span class=n>i1</span><span class=p>:</span><span class=n>i2</span><span class=p>]</span><span class=si>}{</span><span class=n>reset</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>end</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>tag</span> <span class=o>==</span> <span class=s1>&#39;insert&#39;</span><span class=p>:</span>
            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=n>green</span><span class=si>}{</span><span class=n>b</span><span class=p>[</span><span class=n>j1</span><span class=p>:</span><span class=n>j2</span><span class=p>]</span><span class=si>}{</span><span class=n>reset</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>end</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>tag</span> <span class=o>==</span> <span class=s1>&#39;equal&#39;</span><span class=p>:</span>
            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=n>a</span><span class=p>[</span><span class=n>i1</span><span class=p>:</span><span class=n>i2</span><span class=p>]</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>end</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>)</span>

<span class=k>def</span><span class=w> </span><span class=nf>get_differences</span><span class=p>(</span><span class=n>original_text</span><span class=p>,</span> <span class=n>corrected_text</span><span class=p>):</span>
    <span class=n>m</span> <span class=o>=</span> <span class=n>difflib</span><span class=o>.</span><span class=n>SequenceMatcher</span><span class=p>(</span><span class=n>a</span><span class=o>=</span><span class=n>original_text</span><span class=p>,</span> <span class=n>b</span><span class=o>=</span><span class=n>corrected_text</span><span class=p>)</span>
    <span class=n>print_comparision</span><span class=p>(</span><span class=n>m</span><span class=p>,</span> <span class=n>a</span><span class=o>=</span><span class=n>original_text</span><span class=p>,</span> <span class=n>b</span><span class=o>=</span><span class=n>corrected_text</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>m</span>
</code></pre></div> <h3 id=router-input-decide-if-human-feedback-demands-more-changes>Router input: Decide if human feedback demands more changes<a class=headerlink href=#router-input-decide-if-human-feedback-demands-more-changes title="Permanent link">&para;</a></h3> <p>This function is called by the router node and returns 'True' or 'False' for the conditional edge.</p> <div class=highlight><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>need_changes</span><span class=p>(</span><span class=n>human_feedback</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Conditional function that determines if there are any changes to be done based on human feedback</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>is_human_feedback</span> <span class=o>=</span> <span class=n>ChatPromptTemplate</span><span class=o>.</span><span class=n>from_messages</span><span class=p>([</span>
        <span class=p>(</span><span class=s2>&quot;system&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        A human user has provided feedback on markdown file modification done by AI. </span>
<span class=sd>        You need to determine if we need to do any further changes or revert any changes basis on the feedback provided by the human.</span>
<span class=sd>        If further changes need to be done, return &#39;True&#39;. Else return &#39;False&#39;.</span>
<span class=sd>        Except &#39;True&#39; or &#39;False&#39;, dont respond with anything else.</span>
<span class=sd>        &quot;&quot;&quot;</span><span class=p>),</span>
        <span class=p>(</span><span class=s2>&quot;human&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        {human_feedback}</span>
<span class=sd>        Return ONLY &#39;True&#39; or &#39;False&#39;.&quot;&quot;&quot;</span><span class=p>)</span>
    <span class=p>])</span>

    <span class=c1># Prepare prompt</span>
    <span class=n>messages</span> <span class=o>=</span> <span class=n>is_human_feedback</span><span class=o>.</span><span class=n>format_messages</span><span class=p>(</span>
        <span class=n>human_feedback</span> <span class=o>=</span> <span class=n>human_feedback</span>
    <span class=p>)</span>

    <span class=c1># Invoke LLM</span>
    <span class=n>resp</span> <span class=o>=</span> <span class=n>llm</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span><span class=n>messages</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>resp</span><span class=o>.</span><span class=n>content</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</code></pre></div> <h3 id=agent-7-apply-the-humans-requested-changes>Agent 7: Apply the human’s requested changes<a class=headerlink href=#agent-7-apply-the-humans-requested-changes title="Permanent link">&para;</a></h3> <p>This is the human-in-the-loop agent, which applies exactly what the reviewer has requested and nothing more.</p> <div class=highlight><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>apply_changes</span><span class=p>(</span><span class=n>new_markdown</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>old_markdown</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>human_feedback</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Apply changes provided by human feedback</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>apply_human_feedback</span> <span class=o>=</span> <span class=n>ChatPromptTemplate</span><span class=o>.</span><span class=n>from_messages</span><span class=p>([</span>
        <span class=p>(</span><span class=s2>&quot;system&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;You are a html validator and fixer for a markdown to be converted to a html. </span>
<span class=sd>        You have already provided some fixes on the original markdown and a feedback has been provided on it. </span>
<span class=sd>        Basis of the feedback do the changes mentioned.</span>
<span class=sd>        Dont do anything else or change anything else.</span>
<span class=sd>        Return the modified markdown.</span>
<span class=sd>        Do NOT add new content or explanations.</span>
<span class=sd>        Output MUST be the full corrected Markdown document only, without any extra text or code fences.</span>
<span class=sd>        &quot;&quot;&quot;</span><span class=p>),</span>
        <span class=p>(</span><span class=s2>&quot;human&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Original Markdown:</span>
<span class=sd>        -------</span>
<span class=sd>        {old_markdown}</span>
<span class=sd>        -------</span>

<span class=sd>        Modified Markdown:</span>
<span class=sd>        -------</span>
<span class=sd>        {new_markdown}</span>
<span class=sd>        -------</span>

<span class=sd>        Feedback on the changes:</span>
<span class=sd>        {human_feedback}</span>

<span class=sd>        Return ONLY the corrected Markdown. Do NOT include ```markdown fences or any commentary.&quot;&quot;&quot;</span><span class=p>)</span>
    <span class=p>])</span>

    <span class=c1># Prepare prompt</span>
    <span class=n>messages</span> <span class=o>=</span> <span class=n>apply_human_feedback</span><span class=o>.</span><span class=n>format_messages</span><span class=p>(</span>
        <span class=n>new_markdown</span><span class=o>=</span><span class=n>new_markdown</span><span class=p>,</span>
        <span class=n>old_markdown</span><span class=o>=</span><span class=n>old_markdown</span><span class=p>,</span>
        <span class=n>human_feedback</span><span class=o>=</span><span class=n>human_feedback</span>
    <span class=p>)</span>

    <span class=c1># Invoke LLM</span>
    <span class=n>resp</span> <span class=o>=</span> <span class=n>llm</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span><span class=n>messages</span><span class=p>)</span>
    <span class=n>output</span> <span class=o>=</span> <span class=n>resp</span><span class=o>.</span><span class=n>content</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>

    <span class=c1># Cleanup: Remove accidental markdown fences or explanations</span>
    <span class=n>output</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s2>&quot;^```(?:markdown)?\s*&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>output</span><span class=p>)</span>
    <span class=n>output</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s2>&quot;\s*```$&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>output</span><span class=p>)</span>

    <span class=c1># Validate: Ensure output is not empty and contains original structure</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>output</span> <span class=ow>or</span> <span class=nb>len</span><span class=p>(</span><span class=n>output</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>10</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Model returned empty or invalid markdown.&quot;</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>output</span>
</code></pre></div> <h3 id=persistence-save-the-final-html>Persistence: Save the final HTML<a class=headerlink href=#persistence-save-the-final-html title="Permanent link">&para;</a></h3> <p>Simple persistence to disk for the final artefact.</p> <div class=highlight><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>save_modified_html</span><span class=p>(</span><span class=n>modified_html</span><span class=p>,</span> <span class=n>file_path</span><span class=p>):</span>
    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=s2>&quot;w&quot;</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s2>&quot;utf-8&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
        <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>modified_html</span><span class=p>)</span>
    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;File saved successfully at: </span><span class=si>{</span><span class=n>file_path</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
    <span class=k>pass</span>
</code></pre></div> <h3 id=the-state-typed-schema-aggregation-rules>The State: typed schema &amp; aggregation rules<a class=headerlink href=#the-state-typed-schema-aggregation-rules title="Permanent link">&para;</a></h3> <ol> <li><strong>TypedDict</strong> provides a strongly typed state. </li> <li><strong>Annotated[..., operator.add]</strong> defines merge semantics, meaning that if multiple nodes add comments, they are appended in the shared state. </li> </ol> <div class=highlight><pre><span></span><code><span class=k>class</span><span class=w> </span><span class=nc>AppState</span><span class=p>(</span><span class=n>TypedDict</span><span class=p>):</span>
    <span class=n>file_name</span><span class=p>:</span> <span class=nb>str</span> <span class=c1># markdown file link</span>
    <span class=n>markdown</span><span class=p>:</span> <span class=nb>str</span> <span class=c1># initial markdown file</span>

    <span class=c1># Extracted data</span>
    <span class=n>extracted_text</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=n>Literal</span><span class=p>[</span><span class=s1>&#39;header&#39;</span><span class=p>,</span> <span class=s1>&#39;text&#39;</span><span class=p>,</span> <span class=s1>&#39;comment&#39;</span><span class=p>],</span> <span class=nb>str</span><span class=p>]]</span> <span class=c1># Text in the blog</span>
    <span class=n>extracted_code</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=n>Literal</span><span class=p>[</span><span class=s1>&#39;python&#39;</span><span class=p>,</span> <span class=s1>&#39;javascript&#39;</span><span class=p>,</span> <span class=s1>&#39;R&#39;</span><span class=p>],</span> <span class=nb>str</span><span class=p>]</span> <span class=c1># code chunks in the blog</span>

    <span class=c1># improvements</span>
    <span class=n>improved_text_comments</span><span class=p>:</span> <span class=n>Annotated</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]],</span> <span class=n>operator</span><span class=o>.</span><span class=n>add</span><span class=p>]</span>
    <span class=n>improved_code_comments</span><span class=p>:</span> <span class=n>Annotated</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]],</span> <span class=n>operator</span><span class=o>.</span><span class=n>add</span><span class=p>]</span>
    <span class=n>improved_html_comments</span><span class=p>:</span> <span class=n>Annotated</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]],</span> <span class=n>operator</span><span class=o>.</span><span class=n>add</span><span class=p>]</span>

    <span class=c1># Final updated markdown</span>
    <span class=n>code_and_text_fixed_markdown</span><span class=p>:</span> <span class=nb>str</span>
    <span class=n>updated_markdown</span><span class=p>:</span> <span class=nb>str</span> <span class=c1># final updated markdown</span>

    <span class=c1># Human feedback loop</span>
    <span class=n>human_feedback</span><span class=p>:</span> <span class=nb>str</span>
    <span class=n>need_changes</span><span class=p>:</span> <span class=n>Literal</span><span class=p>[</span><span class=s1>&#39;True&#39;</span><span class=p>,</span> <span class=s1>&#39;False&#39;</span><span class=p>]</span>
    <span class=n>iteration</span><span class=p>:</span> <span class=nb>int</span> <span class=c1># loop counter</span>
</code></pre></div> <h3 id=nodes-agents-as-pure-functions>Nodes (agents) as pure functions<a class=headerlink href=#nodes-agents-as-pure-functions title="Permanent link">&para;</a></h3> <p>Each node is a single-responsibility agent operating on <code>AppState</code>. Notice the parallelism: we extract and validate text and code concurrently, then reduce them into a single Markdown file. The router (<code>need_changes_condition</code>) decides the path after human feedback.</p> <div class=highlight><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>node_read_file</span><span class=p>(</span><span class=n>state</span><span class=p>:</span> <span class=n>AppState</span><span class=p>)</span> <span class=o>-&gt;</span>  <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
    <span class=n>htmlmarkdown</span> <span class=o>=</span> <span class=n>read_file</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=s1>&#39;file_name&#39;</span><span class=p>])</span>
    <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;markdown&#39;</span><span class=p>:</span> <span class=n>htmlmarkdown</span><span class=p>}</span>

<span class=k>def</span><span class=w> </span><span class=nf>node_extract_text</span><span class=p>(</span><span class=n>state</span><span class=p>:</span> <span class=n>AppState</span><span class=p>)</span> <span class=o>-&gt;</span>  <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
    <span class=n>extracted_text</span> <span class=o>=</span> <span class=n>extract_text</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=s1>&#39;markdown&#39;</span><span class=p>])</span>
    <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;extracted_text&#39;</span><span class=p>:</span> <span class=n>extracted_text</span><span class=p>}</span>

<span class=k>def</span><span class=w> </span><span class=nf>node_validate_text</span><span class=p>(</span><span class=n>state</span><span class=p>:</span> <span class=n>AppState</span><span class=p>)</span> <span class=o>-&gt;</span>  <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
    <span class=n>improved_text_comments</span> <span class=o>=</span> <span class=n>identify_text_issues</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=s1>&#39;extracted_text&#39;</span><span class=p>])</span>
    <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;improved_text_comments&#39;</span><span class=p>:</span> <span class=n>improved_text_comments</span><span class=p>}</span>

<span class=k>def</span><span class=w> </span><span class=nf>node_extract_code</span><span class=p>(</span><span class=n>state</span><span class=p>:</span> <span class=n>AppState</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
    <span class=n>extracted_code</span> <span class=o>=</span> <span class=n>extract_code</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=s1>&#39;markdown&#39;</span><span class=p>])</span>
    <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;extracted_code&#39;</span><span class=p>:</span> <span class=n>extracted_code</span><span class=p>}</span>

<span class=k>def</span><span class=w> </span><span class=nf>node_validate_code</span><span class=p>(</span><span class=n>state</span><span class=p>:</span> <span class=n>AppState</span><span class=p>)</span> <span class=o>-&gt;</span>  <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
    <span class=n>improved_code_comments</span> <span class=o>=</span> <span class=n>run_code</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=s1>&#39;extracted_code&#39;</span><span class=p>])</span>
    <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;improved_code_comments&#39;</span><span class=p>:</span> <span class=n>improved_code_comments</span><span class=p>}</span>

<span class=k>def</span><span class=w> </span><span class=nf>node_implement_changes</span><span class=p>(</span><span class=n>state</span><span class=p>:</span> <span class=n>AppState</span><span class=p>)</span> <span class=o>-&gt;</span>  <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
    <span class=n>new_markdown</span> <span class=o>=</span> <span class=n>change_markdown</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=s1>&#39;improved_text_comments&#39;</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=s1>&#39;improved_code_comments&#39;</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=s1>&#39;markdown&#39;</span><span class=p>])</span>
    <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;code_and_text_fixed_markdown&#39;</span><span class=p>:</span> <span class=n>new_markdown</span><span class=p>}</span>

<span class=k>def</span><span class=w> </span><span class=nf>node_validate_html</span><span class=p>(</span><span class=n>state</span><span class=p>:</span> <span class=n>AppState</span><span class=p>)</span> <span class=o>-&gt;</span>  <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
    <span class=n>candidate</span> <span class=o>=</span> <span class=n>state</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;updated_markdown&#39;</span><span class=p>)</span> <span class=ow>or</span> <span class=n>state</span><span class=p>[</span><span class=s1>&#39;code_and_text_fixed_markdown&#39;</span><span class=p>]</span>
    <span class=n>new_markdown</span> <span class=o>=</span> <span class=n>validate_html</span><span class=p>(</span><span class=n>candidate</span><span class=p>)</span>
    <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;updated_markdown&#39;</span><span class=p>:</span> <span class=n>new_markdown</span><span class=p>}</span>

<span class=k>def</span><span class=w> </span><span class=nf>node_human_feedback</span><span class=p>(</span><span class=n>state</span><span class=p>:</span> <span class=n>AppState</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Pass-through. Expect &#39;human_feedback&#39; to be set externally via compiled.update_state(...)</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>fb</span> <span class=o>=</span> <span class=n>state</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;human_feedback&quot;</span><span class=p>,</span> <span class=p>{})</span>
    <span class=k>return</span> <span class=p>{</span><span class=s2>&quot;human_feedback&quot;</span><span class=p>:</span> <span class=n>fb</span><span class=p>}</span>

<span class=k>def</span><span class=w> </span><span class=nf>need_changes_condition</span><span class=p>(</span><span class=n>state</span><span class=p>:</span> <span class=n>AppState</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Based on human feedback, do we need further changes to the markdown</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>is_need_changes</span> <span class=o>=</span> <span class=n>need_changes</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=s1>&#39;human_feedback&#39;</span><span class=p>])</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>is_need_changes</span><span class=p>)</span>
    <span class=k>return</span> <span class=kc>True</span> <span class=k>if</span> <span class=n>is_need_changes</span> <span class=o>==</span> <span class=s1>&#39;True&#39;</span> <span class=k>else</span> <span class=kc>False</span>

<span class=k>def</span><span class=w> </span><span class=nf>node_apply_changes</span><span class=p>(</span><span class=n>state</span><span class=p>:</span> <span class=n>AppState</span><span class=p>)</span> <span class=o>-&gt;</span>  <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
    <span class=n>new_markdown</span> <span class=o>=</span> <span class=n>apply_changes</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=s1>&#39;updated_markdown&#39;</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=s1>&#39;markdown&#39;</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=s1>&#39;human_feedback&#39;</span><span class=p>])</span>
    <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;updated_markdown&#39;</span><span class=p>:</span> <span class=n>new_markdown</span><span class=p>}</span>

<span class=k>def</span><span class=w> </span><span class=nf>node_save_html</span><span class=p>(</span><span class=n>state</span><span class=p>:</span> <span class=n>AppState</span><span class=p>):</span>
    <span class=n>save_modified_html</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=s1>&#39;updated_markdown&#39;</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=s1>&#39;file_name&#39;</span><span class=p>])</span>
</code></pre></div> <h3 id=the-graph-wiring-nodes-conditional-edges-memory-and-breakpoints>The Graph: wiring nodes, conditional edges, memory, and breakpoints<a class=headerlink href=#the-graph-wiring-nodes-conditional-edges-memory-and-breakpoints title="Permanent link">&para;</a></h3> <p>Key points:<br> 1. <strong>Map-Reduce</strong>: <em>Read File</em> fans out to <em>Extract Text</em> and <em>Extract Code</em>, then reduces into <em>Implement Changes</em>.<br> 2. <strong>Router</strong>: <code>add_conditional_edges</code> branches to <em>Apply Feedback</em> or <em>Save HTML</em>.<br> 3. <strong>Memory</strong>: <code>MemorySaver</code> is our checkpoint system, tied to <code>thread_id</code>.<br> 4. <strong>Breakpoint</strong>: <code>interrupt_before=['Human Feedback']</code> pauses the graph just before the human review step. </p> <div class=highlight><pre><span></span><code><span class=c1># Build Graph</span>
<span class=n>graph</span> <span class=o>=</span> <span class=n>StateGraph</span><span class=p>(</span><span class=n>AppState</span><span class=p>)</span>

<span class=c1># Nodes</span>
<span class=n>graph</span><span class=o>.</span><span class=n>add_node</span><span class=p>(</span><span class=s2>&quot;Read File&quot;</span><span class=p>,</span> <span class=n>node_read_file</span><span class=p>)</span>
<span class=n>graph</span><span class=o>.</span><span class=n>add_node</span><span class=p>(</span><span class=s2>&quot;Extract Text&quot;</span><span class=p>,</span> <span class=n>node_extract_text</span><span class=p>)</span>
<span class=n>graph</span><span class=o>.</span><span class=n>add_node</span><span class=p>(</span><span class=s2>&quot;Validate Text&quot;</span><span class=p>,</span> <span class=n>node_validate_text</span><span class=p>)</span>
<span class=n>graph</span><span class=o>.</span><span class=n>add_node</span><span class=p>(</span><span class=s2>&quot;Extract Code&quot;</span><span class=p>,</span> <span class=n>node_extract_code</span><span class=p>)</span>
<span class=n>graph</span><span class=o>.</span><span class=n>add_node</span><span class=p>(</span><span class=s2>&quot;Validate Code&quot;</span><span class=p>,</span> <span class=n>node_validate_code</span><span class=p>)</span>
<span class=n>graph</span><span class=o>.</span><span class=n>add_node</span><span class=p>(</span><span class=s2>&quot;Implement Changes&quot;</span><span class=p>,</span> <span class=n>node_implement_changes</span><span class=p>)</span>
<span class=n>graph</span><span class=o>.</span><span class=n>add_node</span><span class=p>(</span><span class=s2>&quot;Validate HTML&quot;</span><span class=p>,</span> <span class=n>node_validate_html</span><span class=p>)</span>
<span class=n>graph</span><span class=o>.</span><span class=n>add_node</span><span class=p>(</span><span class=s2>&quot;Human Feedback&quot;</span><span class=p>,</span> <span class=n>node_human_feedback</span><span class=p>)</span>
<span class=n>graph</span><span class=o>.</span><span class=n>add_node</span><span class=p>(</span><span class=s2>&quot;Apply Feedback&quot;</span><span class=p>,</span> <span class=n>node_apply_changes</span><span class=p>)</span>
<span class=n>graph</span><span class=o>.</span><span class=n>add_node</span><span class=p>(</span><span class=s2>&quot;Save HTML&quot;</span><span class=p>,</span> <span class=n>node_save_html</span><span class=p>)</span>

<span class=c1># Entry and edges (map: fan-out; reduce: fan-in)</span>
<span class=n>graph</span><span class=o>.</span><span class=n>set_entry_point</span><span class=p>(</span><span class=s2>&quot;Read File&quot;</span><span class=p>)</span>
<span class=n>graph</span><span class=o>.</span><span class=n>add_edge</span><span class=p>(</span><span class=s2>&quot;Read File&quot;</span><span class=p>,</span> <span class=s2>&quot;Extract Text&quot;</span><span class=p>)</span>
<span class=n>graph</span><span class=o>.</span><span class=n>add_edge</span><span class=p>(</span><span class=s2>&quot;Extract Text&quot;</span><span class=p>,</span> <span class=s2>&quot;Validate Text&quot;</span><span class=p>)</span>
<span class=n>graph</span><span class=o>.</span><span class=n>add_edge</span><span class=p>(</span><span class=s2>&quot;Read File&quot;</span><span class=p>,</span> <span class=s2>&quot;Extract Code&quot;</span><span class=p>)</span>
<span class=n>graph</span><span class=o>.</span><span class=n>add_edge</span><span class=p>(</span><span class=s2>&quot;Extract Code&quot;</span><span class=p>,</span> <span class=s2>&quot;Validate Code&quot;</span><span class=p>)</span>
<span class=n>graph</span><span class=o>.</span><span class=n>add_edge</span><span class=p>(</span><span class=s2>&quot;Validate Text&quot;</span><span class=p>,</span> <span class=s2>&quot;Implement Changes&quot;</span><span class=p>)</span>
<span class=n>graph</span><span class=o>.</span><span class=n>add_edge</span><span class=p>(</span><span class=s2>&quot;Validate Code&quot;</span><span class=p>,</span> <span class=s2>&quot;Implement Changes&quot;</span><span class=p>)</span>
<span class=n>graph</span><span class=o>.</span><span class=n>add_edge</span><span class=p>(</span><span class=s2>&quot;Implement Changes&quot;</span><span class=p>,</span> <span class=s2>&quot;Validate HTML&quot;</span><span class=p>)</span>
<span class=n>graph</span><span class=o>.</span><span class=n>add_edge</span><span class=p>(</span><span class=s2>&quot;Validate HTML&quot;</span><span class=p>,</span> <span class=s2>&quot;Human Feedback&quot;</span><span class=p>)</span>
<span class=c1># Router: conditional edges based on human feedback</span>
<span class=n>graph</span><span class=o>.</span><span class=n>add_conditional_edges</span><span class=p>(</span><span class=s2>&quot;Human Feedback&quot;</span><span class=p>,</span> <span class=n>need_changes_condition</span><span class=p>,</span> 
    <span class=p>{</span>
        <span class=kc>True</span><span class=p>:</span> <span class=s2>&quot;Apply Feedback&quot;</span><span class=p>,</span>
        <span class=kc>False</span><span class=p>:</span> <span class=s2>&quot;Save HTML&quot;</span>
    <span class=p>}</span>
<span class=p>)</span>
<span class=n>graph</span><span class=o>.</span><span class=n>add_edge</span><span class=p>(</span><span class=s2>&quot;Apply Feedback&quot;</span><span class=p>,</span> <span class=s2>&quot;Validate HTML&quot;</span><span class=p>)</span>
<span class=n>graph</span><span class=o>.</span><span class=n>add_edge</span><span class=p>(</span><span class=s2>&quot;Save HTML&quot;</span><span class=p>,</span> <span class=n>END</span><span class=p>)</span>

<span class=c1># Compile with memory and a breakpoint</span>
<span class=n>memory</span> <span class=o>=</span> <span class=n>MemorySaver</span><span class=p>()</span>
<span class=n>compiled</span> <span class=o>=</span> <span class=n>graph</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=n>interrupt_before</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;Human Feedback&#39;</span><span class=p>],</span> <span class=n>checkpointer</span><span class=o>=</span><span class=n>memory</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=kn>from</span><span class=w> </span><span class=nn>IPython.display</span><span class=w> </span><span class=kn>import</span> <span class=n>Image</span><span class=p>,</span> <span class=n>display</span>
<span class=n>display</span><span class=p>(</span><span class=n>Image</span><span class=p>(</span><span class=n>compiled</span><span class=o>.</span><span class=n>get_graph</span><span class=p>()</span><span class=o>.</span><span class=n>draw_mermaid_png</span><span class=p>()))</span>
</code></pre></div> <p><img alt=png src=output_33_0.png></p> <h2 id=run-the-workflow>Run the workflow<a class=headerlink href=#run-the-workflow title="Permanent link">&para;</a></h2> <p>This sequence demonstrates checkpointed runs, human-in-the-loop control, conditional routing, and final persistence.</p> <div class=highlight><pre><span></span><code><span class=c1>### Start with a file</span>
<span class=n>initial_input</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;file_name&quot;</span><span class=p>:</span> <span class=s1>&#39;/docs/Python/LLM Tokenizers.md&#39;</span><span class=p>}</span>

<span class=c1># Use a persistent thread (for checkpoints)</span>
<span class=n>thread</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;configurable&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;thread_id&quot;</span><span class=p>:</span> <span class=s2>&quot;2&quot;</span><span class=p>}}</span>

<span class=c1># Run until the breakpoint</span>
<span class=n>output</span> <span class=o>=</span> <span class=n>compiled</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span><span class=n>initial_input</span><span class=p>,</span> <span class=n>thread</span><span class=p>)</span>
</code></pre></div> <p><div class=highlight><pre><span></span><code><span class=c1># Inspect diffs</span>
<span class=n>get_differences</span><span class=p>(</span><span class=n>compiled</span><span class=o>.</span><span class=n>get_state</span><span class=p>(</span><span class=n>thread</span><span class=p>)</span><span class=o>.</span><span class=n>values</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;markdown&quot;</span><span class=p>),</span> <span class=n>compiled</span><span class=o>.</span><span class=n>get_state</span><span class=p>(</span><span class=n>thread</span><span class=p>)</span><span class=o>.</span><span class=n>values</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;updated_markdown&quot;</span><span class=p>))</span>
</code></pre></div> <img alt="alt text" src=image-1.png></p> <div class=highlight><pre><span></span><code><span class=c1># Human asks to modify or revert code changes</span>
<span class=n>compiled</span><span class=o>.</span><span class=n>update_state</span><span class=p>(</span><span class=n>thread</span><span class=p>,</span> <span class=p>{</span><span class=s2>&quot;human_feedback&quot;</span><span class=p>:</span> <span class=s2>&quot;Modify the code changes part and revert&quot;</span><span class=p>})</span>
</code></pre></div> <div class=highlight><pre><span></span><code>{&#39;configurable&#39;: {&#39;thread_id&#39;: &#39;2&#39;,
  &#39;checkpoint_ns&#39;: &#39;&#39;,
  &#39;checkpoint_id&#39;: &#39;1f...23&#39;}}
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1># Resume from the breakpoint and route to &quot;Apply Feedback&quot;</span>
<span class=n>output</span> <span class=o>=</span> <span class=n>compiled</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=n>thread</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code>True
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1># Human says &quot;All good.&quot;</span>
<span class=n>compiled</span><span class=o>.</span><span class=n>update_state</span><span class=p>(</span><span class=n>thread</span><span class=p>,</span> <span class=p>{</span><span class=s2>&quot;human_feedback&quot;</span><span class=p>:</span> <span class=s2>&quot;All good.&quot;</span><span class=p>},</span> <span class=n>as_node</span><span class=o>=</span><span class=s2>&quot;Human Feedback&quot;</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code>False





{&#39;configurable&#39;: {&#39;thread_id&#39;: &#39;2&#39;,
  &#39;checkpoint_ns&#39;: &#39;&#39;,
  &#39;checkpoint_id&#39;: &#39;1f...c4&#39;}}
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1># This routes to &quot;Save HTML&quot;</span>
<span class=n>output</span> <span class=o>=</span> <span class=n>compiled</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=n>thread</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code>File saved successfully at: /docs/Python/LLM Tokenizers.md
</code></pre></div> <h2 id=conclusion>Conclusion<a class=headerlink href=#conclusion title="Permanent link">&para;</a></h2> <p>This LangGraph pipeline demonstrates how to build auditable, teachable, and production-ready LLM systems, featuring:<br> 1. Agents as single-responsibility nodes.<br> 2. A stateful graph that supports parallelism and routers.<br> 3. Memory and breakpoints for human oversight.<br> 4. A map-reduce process for scalable processing.<br> 5. Typed state with merge semantics for deterministic behaviour. </p> <p>Written with assistance from Generative AI.</p> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top data-md-state=hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg> Back to top </a> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../RAG/ class="md-footer__link md-footer__link--prev" aria-label="Previous: RAG" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> RAG </div> </div> </a> <a href=../../Others/yashoda_presentation/ class="md-footer__link md-footer__link--next" aria-label="Next: AI in Healthcare" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> AI in Healthcare </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> <img alt="Creative Commons License" style=border-width:0 src=https://i.creativecommons.org/l/by/4.0/88x31.png> </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-footer-contact style="text-align: center; margin: 1rem 0;"> <a href=../../contact title="Contact Me" style="display: inline-flex; align-items: center; gap: 0.5rem; color: rgba(255, 255, 255, 0.7); text-decoration: none;"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24" style="width: 1.2rem; height: 1.2rem; fill: rgba(255, 255, 255, 0.7);"> <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/> </svg> <span>Contact Me</span> </a> </div> <div class=md-footer-social> <a href=https://github.com/HarshaAsh target=_blank rel=noopener title=github.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://www.linkedin.com/in/sri-harsha-achyuthuni/ target=_blank rel=noopener title=www.linkedin.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> <a href=https://www.instagram.com/harshaash_com/ target=_blank rel=noopener title=www.instagram.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"/></svg> </a> <a href=https://www.facebook.com/sri.harsha.achyuthuni/ target=_blank rel=noopener title=www.facebook.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><path d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "content.tabs.link", "header.autohide", "navigation.sections", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "search": "../../assets/javascripts/workers/search.709b4209.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": null}</script> <script src=../../assets/javascripts/bundle.56838a2c.min.js></script> </body> </html>