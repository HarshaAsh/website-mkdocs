<!doctype html><html lang=en class=no-js> <head><!-- Code from google optimiser --><script src="https://www.googleoptimize.com/optimize.js?id=OPT-M98W6LW"></script><!-- Code from Mouseflow --><script type=text/javascript>
      window._mfq = window._mfq || [];
      (function() {
        var mf = document.createElement("script");
        mf.type = "text/javascript"; mf.defer = true;
        mf.src = "//cdn.mouseflow.com/projects/7b4494c9-7974-49f0-9777-d14450db37e6.js";
        document.getElementsByTagName("head")[0].appendChild(mf);
      })();
    </script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Harsha's notes on data science"><meta name=author content="Harsha Achyuthuni"><link href=https://www.harshaash.com/R/CustomerLifetimeValue/ rel=canonical><link rel=icon href=../../assets/images/logo.jpg><meta name=generator content="mkdocs-1.6.1, mkdocs-material-7.2.4"><title>Customer Lifetime Value - Data Science with Harsha</title><link rel=stylesheet href=../../assets/stylesheets/main.f7f47774.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.3f5d1f46.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style><link rel=stylesheet href=../../overrides/assets/stylesheets/user_defined.css><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-65034507-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script><script async src=https://www.google-analytics.com/analytics.js></script></head> <body dir=ltr data-md-color-scheme data-md-color-primary data-md-color-accent> <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script> <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#concept class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Data Science with Harsha" class="md-header__button md-logo" aria-label="Data Science with Harsha" data-md-component=logo> <img src=../../assets/images/logo.jpg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Data Science with Harsha </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Customer Lifetime Value </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme data-md-color-primary data-md-color-accent aria-hidden=true type=radio name=__palette id=__palette_1> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M7 10a2 2 0 0 1 2 2 2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2m10-3a5 5 0 0 1 5 5 5 5 0 0 1-5 5H7a5 5 0 0 1-5-5 5 5 0 0 1 5-5h10M7 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3h10a3 3 0 0 0 3-3 3 3 0 0 0-3-3H7z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme data-md-color-primary data-md-color-accent aria-hidden=true type=radio name=__palette id=__palette_3> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=red data-md-color-accent=red aria-label="Switch to light mode" type=radio name=__palette id=__palette_4> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_3 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08z"/></svg> </a> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Data Science with Harsha" class="md-nav__button md-logo" aria-label="Data Science with Harsha" data-md-component=logo> <img src=../../assets/images/logo.jpg alt=logo> </a> Data Science with Harsha </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Home </a> </li> <li class=md-nav__item> <a href=../../resume/ class=md-nav__link> Resume </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3> Blog <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Blog data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Blog </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Others/Table_of_Contents/ class=md-nav__link> Table of Contents </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2 type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2> Visualization <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Visualization data-md-level=2> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> Visualization </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Python/Vizualisation%20using%20python%20Part%201/ class=md-nav__link> Vizualizing tabular data (Python) </a> </li> <li class=md-nav__item> <a href=../../Python/Visualization%20for%20predictive%20analytics/ class=md-nav__link> Vizualising for predictive analytics (Python) </a> </li> <li class=md-nav__item> <a href=../Univariate-analysis/ class=md-nav__link> Univariate Analysis (R) </a> </li> <li class=md-nav__item> <a href=../multivariateAnalysis/ class=md-nav__link> Multivariate Analysis (R) </a> </li> <li class=md-nav__item> <a href=../multicollinearity/ class=md-nav__link> Multicollinearity (R) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3 type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3> Statistics basics <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Statistics basics" data-md-level=2> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Statistics basics </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Python/Statistics%20basics/ class=md-nav__link> Statistics Basics (Python) </a> </li> <li class=md-nav__item> <a href=../Probability/ class=md-nav__link> Probability (R) </a> </li> <li class=md-nav__item> <a href=../vectors/ class=md-nav__link> Vectors (R) </a> </li> <li class=md-nav__item> <a href=../matrices/ class=md-nav__link> Matrices (R) </a> </li> <li class=md-nav__item> <a href=../../Python/Call%20center%20distributions/ class=md-nav__link> Call center distributions (Python) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_4 type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4> Hypothesis Testing <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Hypothesis Testing" data-md-level=2> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Hypothesis Testing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../attendance_t_test/ class=md-nav__link> z-test and t-test (R) </a> </li> <li class=md-nav__item> <a href=../anova/ class=md-nav__link> ANOVA Test (R) </a> </li> <li class=md-nav__item> <a href=../chi-sq-goodness-of-fit/ class=md-nav__link> Chi-Square Goodness of fit (R) </a> </li> <li class=md-nav__item> <a href=../chi-sq-test-of-independence/ class=md-nav__link> Chi-Square test of independence (R) </a> </li> <li class=md-nav__item> <a href=../../Python/Hypothesis_Testing_Python/ class=md-nav__link> Hypothesis testing using Python </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_5 type=checkbox id=__nav_3_5> <label class=md-nav__link for=__nav_3_5> Factor Analysis <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Factor Analysis" data-md-level=2> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> Factor Analysis </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Curse-of-Dimensionality/ class=md-nav__link> Curse of dimensionality </a> </li> <li class=md-nav__item> <a href=../EFA/ class=md-nav__link> Exploratory factor analysis (R) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_6 type=checkbox id=__nav_3_6> <label class=md-nav__link for=__nav_3_6> Preprocessing data <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Preprocessing data" data-md-level=2> <label class=md-nav__title for=__nav_3_6> <span class="md-nav__icon md-icon"></span> Preprocessing data </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../KNN_Imputation/ class=md-nav__link> Null Value Imputation (R) </a> </li> <li class=md-nav__item> <a href=../../Python/Machine%20Learning%20Part%201/ class=md-nav__link> Feature engineering (Python) </a> </li> <li class=md-nav__item> <a href=../Handling-Imbalanced-classes/ class=md-nav__link> Handling Imbalanced Classes </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_7 type=checkbox id=__nav_3_7> <label class=md-nav__link for=__nav_3_7> Prediction algorithms <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Prediction algorithms" data-md-level=2> <label class=md-nav__title for=__nav_3_7> <span class="md-nav__icon md-icon"></span> Prediction algorithms </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_7_1 type=checkbox id=__nav_3_7_1> <label class=md-nav__link for=__nav_3_7_1> Classification Algorithms <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Classification Algorithms" data-md-level=3> <label class=md-nav__title for=__nav_3_7_1> <span class="md-nav__icon md-icon"></span> Classification Algorithms </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../logistic-regression/ class=md-nav__link> Logistic Regression (R) </a> </li> <li class=md-nav__item> <a href=../CHAID/ class=md-nav__link> CHAID Decision Trees (R) </a> </li> <li class=md-nav__item> <a href=../CART-Classification/ class=md-nav__link> CART Classification (R) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_7_2 type=checkbox id=__nav_3_7_2> <label class=md-nav__link for=__nav_3_7_2> Regression Algorithms <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Regression Algorithms" data-md-level=3> <label class=md-nav__title for=__nav_3_7_2> <span class="md-nav__icon md-icon"></span> Regression Algorithms </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../part-and-partial-corr/ class=md-nav__link> Part and partial correlation </a> </li> <li class=md-nav__item> <a href=../Linear-regression/ class=md-nav__link> Linear Regression (R) </a> </li> <li class=md-nav__item> <a href=../../Python/Linear%20regression%20usecase%20mpg%20prediction/ class=md-nav__link> Lasso and Ridge regression (Python) </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_8 type=checkbox id=__nav_3_8> <label class=md-nav__link for=__nav_3_8> Machine Learning <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Machine Learning" data-md-level=2> <label class=md-nav__title for=__nav_3_8> <span class="md-nav__icon md-icon"></span> Machine Learning </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=https://harshaachyuthuni.shinyapps.io/Machine_Learning/ class=md-nav__link> Interactive Machine Learning (RShiny) </a> </li> <li class=md-nav__item> <a href=../../Python/ML%20using%20scikit-learn/ class=md-nav__link> Multi models (Python) </a> </li> <li class=md-nav__item> <a href=../../Python/Explainable%20models%20using%20Heart%20Failure/ class=md-nav__link> Explainable ML (Python) </a> </li> <li class=md-nav__item> <a href=../../Python/Demonstrating%20online%20learning/ class=md-nav__link> Streaming Machine Learning (Python) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_9 type=checkbox id=__nav_3_9> <label class=md-nav__link for=__nav_3_9> Time Series forecasting <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Time Series forecasting" data-md-level=2> <label class=md-nav__title for=__nav_3_9> <span class="md-nav__icon md-icon"></span> Time Series forecasting </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../time-series/ class=md-nav__link> Introduction to stationarity (R) </a> </li> <li class=md-nav__item> <a href=../Stationarity-tests/ class=md-nav__link> Stationary Tests (R) </a> </li> <li class=md-nav__item> <a href=../ARIMA/ class=md-nav__link> ARIMA in R </a> </li> <li class=md-nav__item> <a href=../../Python/ARIMA%20Forecasting/ class=md-nav__link> ARIMA in Python </a> </li> <li class=md-nav__item> <a href=../Seasonal-Time-Series/ class=md-nav__link> Seasonal time series (R) </a> </li> <li class=md-nav__item> <a href=../VAR-models/ class=md-nav__link> VAR Models (R) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_10 type=checkbox id=__nav_3_10> <label class=md-nav__link for=__nav_3_10> Deep learning <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Deep learning" data-md-level=2> <label class=md-nav__title for=__nav_3_10> <span class="md-nav__icon md-icon"></span> Deep learning </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Python/ANN-1/ class=md-nav__link> Perceptron </a> </li> <li class=md-nav__item> <a href=../../Python/Backpropagation/ class=md-nav__link> Backpropagation </a> </li> <li class=md-nav__item> <a href=../../Python/DNN/ class=md-nav__link> Tensorflow and Keras </a> </li> <li class=md-nav__item> <a href=../../Python/Time%20series%20deep%20learning/ class=md-nav__link> Time series (python) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_11 type=checkbox id=__nav_3_11> <label class=md-nav__link for=__nav_3_11> Generative AI <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Generative AI" data-md-level=2> <label class=md-nav__title for=__nav_3_11> <span class="md-nav__icon md-icon"></span> Generative AI </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Python/LLM%20Tokenizers/ class=md-nav__link> LLM Tokenizers </a> </li> <li class=md-nav__item> <a href=../../Python/prompt_engineering_techniques/ class=md-nav__link> Prompt Engineering </a> </li> <li class=md-nav__item> <a href=../../Python/Agentic%20AI/ class=md-nav__link> Agentic AI </a> </li> <li class=md-nav__item> <a href=../../Python/RAG/ class=md-nav__link> RAG </a> </li> <li class=md-nav__item> <a href=../../Python/Blog%20validation/ class=md-nav__link> LangGraphs </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_12 type=checkbox id=__nav_3_12> <label class=md-nav__link for=__nav_3_12> Prescriptive Analytics <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Prescriptive Analytics" data-md-level=2> <label class=md-nav__title for=__nav_3_12> <span class="md-nav__icon md-icon"></span> Prescriptive Analytics </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linear-programming/ class=md-nav__link> Linear Programming (R) </a> </li> <li class=md-nav__item> <a href=../../Others/integer_programming_blog/ class=md-nav__link> Integer Programming tricks </a> </li> <li class=md-nav__item> <a href=../../Python/inventory_optimization_eoq_ortools/ class=md-nav__link> Inventory Optimisation (Python) </a> </li> <li class=md-nav__item> <a href=../adoption_of_new_product/ class=md-nav__link> Adoption of new product (R) </a> </li> <li class=md-nav__item> <a href=../../Python/Diffusion%20on%20networks/ class=md-nav__link> Bass Forecasting model (Python) </a> </li> <li class=md-nav__item> <a href=../../Others/AHP/ class=md-nav__link> Analytic Hierarchy Process </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_13 type=checkbox id=__nav_3_13> <label class=md-nav__link for=__nav_3_13> Clustering <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Clustering data-md-level=2> <label class=md-nav__title for=__nav_3_13> <span class="md-nav__icon md-icon"></span> Clustering </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../hierarchical_clustering/ class=md-nav__link> Hierarchical Clustering </a> </li> <li class=md-nav__item> <a href=../kMeansClustering/ class=md-nav__link> K-Means Clustering </a> </li> <li class=md-nav__item> <a href=../../Python/train_delays/ class=md-nav__link> DBSCAN Clustering (Python) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_14 type=checkbox id=__nav_3_14 checked> <label class=md-nav__link for=__nav_3_14> Reinforcement Learning <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Reinforcement Learning" data-md-level=2> <label class=md-nav__title for=__nav_3_14> <span class="md-nav__icon md-icon"></span> Reinforcement Learning </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Customer Lifetime Value <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Customer Lifetime Value </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#concept class=md-nav__link> Concept </a> <nav class=md-nav aria-label=Concept> <ul class=md-nav__list> <li class=md-nav__item> <a href=#markov-chains class=md-nav__link> Markov Chains </a> </li> <li class=md-nav__item> <a href=#customer-lifetime-value class=md-nav__link> Customer Lifetime Value </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#data class=md-nav__link> Data </a> </li> <li class=md-nav__item> <a href=#creating-a-markov-chain class=md-nav__link> Creating a Markov chain </a> </li> <li class=md-nav__item> <a href=#customer-lifetime-value_1 class=md-nav__link> Customer Lifetime value </a> </li> <li class=md-nav__item> <a href=#references class=md-nav__link> References </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../recommendation-systems/ class=md-nav__link> Recommendation Systems (R) </a> </li> <li class=md-nav__item> <a href=../../Python/Neural_collaborative_filtering/ class=md-nav__link> Collaborative Filtering (Python) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_15 type=checkbox id=__nav_3_15> <label class=md-nav__link for=__nav_3_15> Networks <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Networks data-md-level=2> <label class=md-nav__title for=__nav_3_15> <span class="md-nav__icon md-icon"></span> Networks </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Python/Introduction%20to%20Networkx/ class=md-nav__link> Introduction to NetworkX (Python) </a> </li> <li class=md-nav__item> <a href=../../Python/Network%20Science/ class=md-nav__link> Network Science (Python) </a> </li> <li class=md-nav__item> <a href=../../Python/Network%20centrality/ class=md-nav__link> Network Centrality (Python) </a> </li> <li class=md-nav__item> <a href=../../Python/Shortest%20path%20problems/ class=md-nav__link> Shortest path using integer programming (Python) </a> </li> <li class=md-nav__item> <a href=../../Python/Network%20Flow%20problems/ class=md-nav__link> Network flow problems (Python) </a> </li> <li class=md-nav__item> <a href=../../Python/Community%20detection/ class=md-nav__link> Community detection (Python) </a> </li> <li class=md-nav__item> <a href=../../Python/Bipartite%20matching/ class=md-nav__link> Bipartite matching (Python) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_16 type=checkbox id=__nav_3_16> <label class=md-nav__link for=__nav_3_16> Deployment <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Deployment data-md-level=2> <label class=md-nav__title for=__nav_3_16> <span class="md-nav__icon md-icon"></span> Deployment </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Python/Machine%20learning%20as%20HTTP%20Request/ class=md-nav__link> ML deployment in Flask (Python) </a> </li> <li class=md-nav__item> <a href=../../Python/Saving%20predictions%20in%20database/ class=md-nav__link> Handling databases using python </a> </li> <li class=md-nav__item> <a href=../../Python/ORM/ class=md-nav__link> ORM (Python) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_17 type=checkbox id=__nav_3_17> <label class=md-nav__link for=__nav_3_17> Higher education review <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Higher education review" data-md-level=2> <label class=md-nav__title for=__nav_3_17> <span class="md-nav__icon md-icon"></span> Higher education review </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Others/IIMB%20BAI/ class=md-nav__link> IIMB BAI </a> </li> <li class=md-nav__item> <a href=../../Others/part%20time%20data%20science%20masters/ class=md-nav__link> Part-time DS masters </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_18 type=checkbox id=__nav_3_18> <label class=md-nav__link for=__nav_3_18> External blogs <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="External blogs" data-md-level=2> <label class=md-nav__title for=__nav_3_18> <span class="md-nav__icon md-icon"></span> External blogs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Others/Imperial%20College%20London/ class=md-nav__link> Imperial college London </a> </li> <li class=md-nav__item> <a href=../../Others/Publications/ class=md-nav__link> Publications/conferences </a> </li> <li class=md-nav__item> <a href=../../Others/Deployed%20apps/ class=md-nav__link> Deployed apps </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_19 type=checkbox id=__nav_3_19> <label class=md-nav__link for=__nav_3_19> Projects <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Projects data-md-level=2> <label class=md-nav__title for=__nav_3_19> <span class="md-nav__icon md-icon"></span> Projects </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Others/preventive_maintainence/ class=md-nav__link> Preventive maintainence </a> </li> <li class=md-nav__item> <a href=../../Others/Contract%20Intelligence%20tool/ class=md-nav__link> Contract Intelligence </a> </li> <li class=md-nav__item> <a href=../../Others/competitor%20intelligence/ class=md-nav__link> Competitor intelligence </a> </li> <li class=md-nav__item> <a href=../../Others/quiz%20generation/ class=md-nav__link> Quiz Generation </a> </li> <li class=md-nav__item> <a href=../../Others/Scarecrow/ class=md-nav__link> Intelligent annotation </a> </li> <li class=md-nav__item> <a href=../../Others/Demand%20Forecasting/ class=md-nav__link> Demand Forecasting </a> </li> <li class=md-nav__item> <a href=../../Others/bid%20allocation%20model/ class=md-nav__link> Bid Allocation </a> </li> <li class=md-nav__item> <a href=../../Others/IIMB%20project/ class=md-nav__link> Reward and Recognition contests </a> </li> <li class=md-nav__item> <a href=../../Others/supply%20chain%20analytics/ class=md-nav__link> Supply chain analytics </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#concept class=md-nav__link> Concept </a> <nav class=md-nav aria-label=Concept> <ul class=md-nav__list> <li class=md-nav__item> <a href=#markov-chains class=md-nav__link> Markov Chains </a> </li> <li class=md-nav__item> <a href=#customer-lifetime-value class=md-nav__link> Customer Lifetime Value </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#data class=md-nav__link> Data </a> </li> <li class=md-nav__item> <a href=#creating-a-markov-chain class=md-nav__link> Creating a Markov chain </a> </li> <li class=md-nav__item> <a href=#customer-lifetime-value_1 class=md-nav__link> Customer Lifetime value </a> </li> <li class=md-nav__item> <a href=#references class=md-nav__link> References </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>Customer Lifetime Value</h1> <script type=text/javascript src=https://cdn.mathjax.org/mathjax/latest/MathJax.js>
MathJax.Hub.Config({
 extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js"],
 jax: ["input/TeX", "output/HTML-CSS"],
 tex2jax: {
     inlineMath: [ ['$','$'], ["\\(","\\)"] ],
     displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
 },
 "HTML-CSS": { availableFonts: ["TeX"] }
});
</script> <p>In this blog, I want to introduce Markov chains and find out the customer lifetime value. Customer Lifetime Value is the net present value (NPV) of the future margin generated from a customer or a customer segment. </p> <h2 id=concept>Concept<a class=headerlink href=#concept title="Permanent link">&para;</a></h2> <h3 id=markov-chains>Markov Chains<a class=headerlink href=#markov-chains title="Permanent link">&para;</a></h3> <p>In probability theory and statistics, a sequence or other collection of random variables is independent and identically distributed (i.i.d) if each random variable has the same probability distribution as the others and all are mutually independent.<br> We have a set of states, S = {<span class=arithmatex>\(s_1, s_2,...,s_r\)</span>}. The process starts in one of these states and moves successively from one state to another. Each move is called a step. If the chain is currently in state <span class=arithmatex>\(s_i\)</span>, then it moves to state <span class=arithmatex>\(s_j\)</span> at the next step with a probability denoted by <span class=arithmatex>\(p_{ij}\)</span>, and this probability does not depend upon which states the chain was in before the current state.</p> <p>That is the probability to be present in state j at time <em>t+1</em> is only dependent on the state at time <em>t</em>. $$ P_{ij} = P(X_{t+1} = j | X_{t} = i) $$</p> <h3 id=customer-lifetime-value>Customer Lifetime Value<a class=headerlink href=#customer-lifetime-value title="Permanent link">&para;</a></h3> <p>Customer lifetime value is important because, the higher the number, the greater the profits. You'll always have to spend money to acquire new customers and to retain existing ones, but the former costs five times as much. When you know your customer lifetime value, you can improve it.</p> <p>The customer segments can be represented as states of the Markov chain. Let {0, 1, 2, …, m} be the states of a Markov chain in which states {1, 2,..., m} denote different customer segments and state 0 denotes non-customer state. </p> <p>The steady-state retention probability is given by $$ R_t = 1 - \frac{\pi_0(1-P_{00})}{1-\pi_0}$$ Where <span class=arithmatex>\(P_{00}\)</span> is the transition probability of State 0, and <span class=arithmatex>\(\pi_0\)</span> is the steady-state distribution for State 0. </p> <p>Similarly, Customer lifetime value for N periods is given by:<br> $$ CLV = \sum_{t=0}^{N} \frac{P_I×P<sup>t×R}{(1+i)</sup>t} $$<br> Where PI is the initial distribution of customers in different states, P is the transition probability matrix, R is the reward vector (margin generated in each customer segment). The interest rate is i (discount rate), <span class=arithmatex>\(d = 1 + \frac{1}{1+i}\)</span> is the discount factor. </p> <h2 id=data>Data<a class=headerlink href=#data title="Permanent link">&para;</a></h2> <p>The data is obtained from the <a href=http://archive.ics.uci.edu/ml/datasets/online+retail>UCI machine learning repository</a>. It is an Online Retail Data Set which contains all the transactions occurring between 01/12/2010 and 09/12/2011 for a UK-based and registered non-store online retail. The company mainly sells unique all-occasion gifts. Many customers of the company are wholesalers. </p> <p>A sample data is shown below</p> <table class=table style="margin-left: auto; margin-right: auto;"> <caption>raw_data</caption> <thead> <tr> <th style=text-align:center;> InvoiceNo </th> <th style=text-align:center;> StockCode </th> <th style=text-align:center;> Description </th> <th style=text-align:center;> Quantity </th> <th style=text-align:center;> InvoiceDate </th> <th style=text-align:center;> UnitPrice </th> <th style=text-align:center;> CustomerID </th> <th style=text-align:center;> Country </th> </tr> </thead> <tbody> <tr> <td style=text-align:center;> 579529 </td> <td style=text-align:center;> 20750 </td> <td style=text-align:center;> RED RETROSPOT MINI CASES </td> <td style=text-align:center;> 2 </td> <td style=text-align:center;> 2011-11-30 08:50:00 </td> <td style=text-align:center;> 7.95 </td> <td style=text-align:center;> 12488 </td> <td style=text-align:center;> France </td> </tr> <tr> <td style=text-align:center;> 568919 </td> <td style=text-align:center;> 22615 </td> <td style=text-align:center;> PACK OF 12 CIRCUS PARADE TISSUES </td> <td style=text-align:center;> 12 </td> <td style=text-align:center;> 2011-09-29 14:38:00 </td> <td style=text-align:center;> 0.39 </td> <td style=text-align:center;> 12937 </td> <td style=text-align:center;> United Kingdom </td> </tr> <tr> <td style=text-align:center;> 559521 </td> <td style=text-align:center;> 22553 </td> <td style=text-align:center;> PLASTERS IN TIN SKULLS </td> <td style=text-align:center;> 7 </td> <td style=text-align:center;> 2011-07-08 16:26:00 </td> <td style=text-align:center;> 1.65 </td> <td style=text-align:center;> NA </td> <td style=text-align:center;> Unspecified </td> </tr> <tr> <td style=text-align:center;> 569640 </td> <td style=text-align:center;> 22961 </td> <td style=text-align:center;> JAM MAKING SET PRINTED </td> <td style=text-align:center;> 12 </td> <td style=text-align:center;> 2011-10-05 12:25:00 </td> <td style=text-align:center;> 1.45 </td> <td style=text-align:center;> 12471 </td> <td style=text-align:center;> Germany </td> </tr> <tr> <td style=text-align:center;> 548542 </td> <td style=text-align:center;> 22076 </td> <td style=text-align:center;> 6 RIBBONS EMPIRE </td> <td style=text-align:center;> 12 </td> <td style=text-align:center;> 2011-03-31 18:05:00 </td> <td style=text-align:center;> 1.65 </td> <td style=text-align:center;> 13918 </td> <td style=text-align:center;> United Kingdom </td> </tr> </tbody> </table> <div class=highlight><pre><span></span><code>##   InvoiceNo          StockCode         Description           Quantity        
##  Length:541909      Length:541909      Length:541909      Min.   :-80995.00  
##  Class :character   Class :character   Class :character   1st Qu.:     1.00  
##  Mode  :character   Mode  :character   Mode  :character   Median :     3.00  
##                                                           Mean   :     9.55  
##                                                           3rd Qu.:    10.00  
##                                                           Max.   : 80995.00  
##                                                                              
##   InvoiceDate                    UnitPrice           CustomerID    
##  Min.   :2010-12-01 08:26:00   Min.   :-11062.06   Min.   :12346   
##  1st Qu.:2011-03-28 11:34:00   1st Qu.:     1.25   1st Qu.:13953   
##  Median :2011-07-19 17:17:00   Median :     2.08   Median :15152   
##  Mean   :2011-07-04 13:34:57   Mean   :     4.61   Mean   :15288   
##  3rd Qu.:2011-10-19 11:27:00   3rd Qu.:     4.13   3rd Qu.:16791   
##  Max.   :2011-12-09 12:50:00   Max.   : 38970.00   Max.   :18287   
##                                                    NA&#39;s   :135080  
##    Country         
##  Length:541909     
##  Class :character  
##  Mode  :character  
##                    
##                    
##                    
## 
</code></pre></div> <p>As I want to calculate CLV, I want to filter for customers that have done a transaction in Dec 2010 (only they will have enough representation in all states). </p> <p>Filter for customers that have done a transaction in Dec 2010</p> <div class=highlight><pre><span></span><code><span class=n>cust_name</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=p>(</span><span class=n>raw_data</span><span class=w> </span><span class=o>%&gt;%</span><span class=w> </span>
<span class=w>                </span><span class=nf>filter</span><span class=p>(</span><span class=nf>month</span><span class=p>(</span><span class=n>InvoiceDate</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=m>12</span><span class=p>,</span><span class=w> </span><span class=nf>year</span><span class=p>(</span><span class=n>InvoiceDate</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=m>2010</span><span class=p>,</span><span class=w> </span><span class=o>!</span><span class=nf>is.na</span><span class=p>(</span><span class=n>CustomerID</span><span class=p>)</span><span class=w> </span><span class=p>)</span><span class=w> </span><span class=o>%&gt;%</span><span class=w> </span>
<span class=w>  </span><span class=n>dplyr</span><span class=o>::</span><span class=nf>select</span><span class=p>(</span><span class=n>CustomerID</span><span class=p>)</span><span class=w> </span><span class=o>%&gt;%</span><span class=w> </span>
<span class=w>  </span><span class=nf>unique</span><span class=p>())</span><span class=o>$</span><span class=n>CustomerID</span>
<span class=n>filtered_data</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=n>raw_data</span><span class=w> </span><span class=o>%&gt;%</span><span class=w> </span><span class=nf>filter</span><span class=p>(</span><span class=n>CustomerID</span><span class=w> </span><span class=o>%in%</span><span class=w> </span><span class=n>cust_name</span><span class=p>)</span><span class=w> </span><span class=o>%&gt;%</span><span class=w> </span><span class=nf>group_by</span><span class=p>(</span><span class=n>InvoiceDate</span><span class=p>,</span><span class=w> </span><span class=n>CustomerID</span><span class=p>,</span><span class=w> </span><span class=n>Country</span><span class=p>)</span><span class=w> </span><span class=o>%&gt;%</span><span class=w> </span>
<span class=w>  </span><span class=nf>summarise</span><span class=p>(</span><span class=n>no_trans</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>n</span><span class=p>(),</span><span class=w> </span><span class=n>total_sales</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>sum</span><span class=p>(</span><span class=n>UnitPrice</span><span class=p>),</span><span class=w> </span><span class=n>mean_sales</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>mean</span><span class=p>(</span><span class=n>UnitPrice</span><span class=p>),</span><span class=w> </span><span class=n>total_quantity</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>sum</span><span class=p>(</span><span class=n>Quantity</span><span class=p>))</span>
<span class=nf>cat</span><span class=p>(</span><span class=s>&#39;The total number of customers are&#39;</span><span class=p>,</span><span class=nf>length</span><span class=p>(</span><span class=n>cust_name</span><span class=p>))</span>
</code></pre></div> <div class=highlight><pre><span></span><code>## The total number of customers are 948
</code></pre></div> <p>For random 10 customers, the total sales and number of items sold across time are shown in a bubble plot.<br> <img alt src=../CustomerLifetimeValue_files/figure-html/bubble-plot-1.png><!-- --></p> <p>You can observe that there are gaps between purchases for different customers. 'Gap' is the difference in months between two successive purchases or the difference between the current month (despite no purchase) and the last purchase month. The frequency distribution of all the purchases at different gaps is shown below: </p> <table class=table style="margin-left: auto; margin-right: auto;"> <caption>Cumulative frequency</caption> <thead> <tr> <th style=text-align:center;> gap_month </th> <th style=text-align:center;> Count </th> <th style=text-align:center;> cumsum </th> </tr> </thead> <tbody> <tr> <td style=text-align:center;> 0 </td> <td style=text-align:center;> 489 </td> <td style=text-align:center;> 51.58228 </td> </tr> <tr> <td style=text-align:center;> 1 </td> <td style=text-align:center;> 108 </td> <td style=text-align:center;> 62.97468 </td> </tr> <tr> <td style=text-align:center;> 2 </td> <td style=text-align:center;> 50 </td> <td style=text-align:center;> 68.24895 </td> </tr> <tr> <td style=text-align:center;> 3 </td> <td style=text-align:center;> 33 </td> <td style=text-align:center;> 71.72996 </td> </tr> <tr> <td style=text-align:center;> 4 </td> <td style=text-align:center;> 20 </td> <td style=text-align:center;> 73.83966 </td> </tr> <tr> <td style=text-align:center;> 5 </td> <td style=text-align:center;> 30 </td> <td style=text-align:center;> 77.00422 </td> </tr> <tr> <td style=text-align:center;> 6 </td> <td style=text-align:center;> 18 </td> <td style=text-align:center;> 78.90295 </td> </tr> <tr> <td style=text-align:center;> 7 </td> <td style=text-align:center;> 18 </td> <td style=text-align:center;> 80.80169 </td> </tr> <tr> <td style=text-align:center;> 8 </td> <td style=text-align:center;> 21 </td> <td style=text-align:center;> 83.01688 </td> </tr> <tr> <td style=text-align:center;> 9 </td> <td style=text-align:center;> 6 </td> <td style=text-align:center;> 83.64979 </td> </tr> <tr> <td style=text-align:center;> 10 </td> <td style=text-align:center;> 20 </td> <td style=text-align:center;> 85.75949 </td> </tr> <tr> <td style=text-align:center;> 11 </td> <td style=text-align:center;> 38 </td> <td style=text-align:center;> 89.76793 </td> </tr> <tr> <td style=text-align:center;> 12 </td> <td style=text-align:center;> 97 </td> <td style=text-align:center;> 100.00000 </td> </tr> </tbody> </table> <p>From the above distribution, I am assuming that a customer who has not transacted for greater than 6 months is inactive. </p> <h2 id=creating-a-markov-chain>Creating a Markov chain<a class=headerlink href=#creating-a-markov-chain title="Permanent link">&para;</a></h2> <p>Loading the libraries required in this section</p> <p>At 2011-06-01, the state of a customer is given by:</p> <div class=highlight><pre><span></span><code><span class=n>elapsed_months</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=kr>function</span><span class=p>(</span><span class=n>end_date</span><span class=p>,</span><span class=w> </span><span class=n>start_date</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=n>ed</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>as.POSIXlt</span><span class=p>(</span><span class=n>end_date</span><span class=p>)</span>
<span class=w>    </span><span class=n>sd</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>as.POSIXlt</span><span class=p>(</span><span class=n>start_date</span><span class=p>)</span>
<span class=w>    </span><span class=m>12</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=p>(</span><span class=n>ed</span><span class=o>$</span><span class=n>year</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>sd</span><span class=o>$</span><span class=n>year</span><span class=p>)</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=p>(</span><span class=n>ed</span><span class=o>$</span><span class=n>mon</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>sd</span><span class=o>$</span><span class=n>mon</span><span class=p>)</span>
<span class=p>}</span>
<span class=n>final_classes</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=n>filtered_data</span><span class=w> </span><span class=o>%&gt;%</span><span class=w> </span><span class=nf>filter</span><span class=p>(</span><span class=n>InvoiceDate</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=nf>date</span><span class=p>(</span><span class=s>&#39;2011-07-01&#39;</span><span class=p>))</span><span class=w> </span><span class=o>%&gt;%</span>
<span class=w>  </span><span class=nf>group_by</span><span class=p>(</span><span class=n>CustomerID</span><span class=p>)</span><span class=w> </span><span class=o>%&gt;%</span><span class=w> </span>
<span class=w>  </span><span class=nf>summarise</span><span class=p>(</span><span class=n>recent_purchase_date</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>max</span><span class=p>(</span><span class=n>InvoiceDate</span><span class=p>))</span><span class=w> </span><span class=o>%&gt;%</span><span class=w> </span>
<span class=w>  </span><span class=nf>mutate</span><span class=p>(</span><span class=n>Class1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>elapsed_months</span><span class=p>(</span><span class=nf>date</span><span class=p>(</span><span class=s>&#39;2011-07-01&#39;</span><span class=p>),</span><span class=w> </span><span class=nf>date</span><span class=p>(</span><span class=n>recent_purchase_date</span><span class=p>)))</span><span class=w> </span><span class=o>%&gt;%</span><span class=w> </span>
<span class=w>  </span><span class=nf>mutate</span><span class=p>(</span><span class=n>Class1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>as.integer</span><span class=p>(</span><span class=n>Class1</span><span class=p>))</span>
<span class=nf>kable</span><span class=p>(</span><span class=n>final_classes</span><span class=w> </span><span class=o>%&gt;%</span><span class=w> </span><span class=nf>sample_n</span><span class=p>(</span><span class=m>10</span><span class=p>),</span><span class=w> </span><span class=n>align</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#39;c&#39;</span><span class=p>,</span><span class=w> </span><span class=n>caption</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#39;Initial state&#39;</span><span class=p>)</span><span class=w> </span><span class=o>%&gt;%</span><span class=w> </span>
<span class=w>   </span><span class=nf>kable_styling</span><span class=p>(</span><span class=n>full_width</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=bp>F</span><span class=p>)</span>
</code></pre></div> <table class=table style="margin-left: auto; margin-right: auto;"> <caption>Initial state</caption> <thead> <tr> <th style=text-align:center;> CustomerID </th> <th style=text-align:center;> recent_purchase_date </th> <th style=text-align:center;> Class1 </th> </tr> </thead> <tbody> <tr> <td style=text-align:center;> 17450 </td> <td style=text-align:center;> 2011-06-21 16:01:00 </td> <td style=text-align:center;> 1 </td> </tr> <tr> <td style=text-align:center;> 14896 </td> <td style=text-align:center;> 2011-05-19 10:20:00 </td> <td style=text-align:center;> 2 </td> </tr> <tr> <td style=text-align:center;> 18061 </td> <td style=text-align:center;> 2011-06-10 14:46:00 </td> <td style=text-align:center;> 1 </td> </tr> <tr> <td style=text-align:center;> 13065 </td> <td style=text-align:center;> 2010-12-01 16:52:00 </td> <td style=text-align:center;> 7 </td> </tr> <tr> <td style=text-align:center;> 17231 </td> <td style=text-align:center;> 2011-06-02 19:50:00 </td> <td style=text-align:center;> 1 </td> </tr> <tr> <td style=text-align:center;> 15894 </td> <td style=text-align:center;> 2011-03-31 13:50:00 </td> <td style=text-align:center;> 4 </td> </tr> <tr> <td style=text-align:center;> 14729 </td> <td style=text-align:center;> 2010-12-01 12:43:00 </td> <td style=text-align:center;> 7 </td> </tr> <tr> <td style=text-align:center;> 15965 </td> <td style=text-align:center;> 2010-12-07 13:18:00 </td> <td style=text-align:center;> 7 </td> </tr> <tr> <td style=text-align:center;> 15834 </td> <td style=text-align:center;> 2011-06-27 10:16:00 </td> <td style=text-align:center;> 1 </td> </tr> <tr> <td style=text-align:center;> 16081 </td> <td style=text-align:center;> 2011-06-07 13:31:00 </td> <td style=text-align:center;> 1 </td> </tr> </tbody> </table> <p>Here the states are defined as: </p> <table> <thead> <tr> <th>State</th> <th>Recency Level</th> <th>Explanation</th> </tr> </thead> <tbody> <tr> <td>1</td> <td>1</td> <td>Last purchase made this month</td> </tr> <tr> <td>2</td> <td>2</td> <td>Last purchase made last month</td> </tr> <tr> <td>3</td> <td>3</td> <td>Last purchase made 2 months ago</td> </tr> <tr> <td>4</td> <td>4</td> <td>Last purchase made 3 months ago</td> </tr> <tr> <td>5</td> <td>5</td> <td>Last purchase made 4 months ago</td> </tr> <tr> <td>6</td> <td>6</td> <td>Last purchase made 5 months ago</td> </tr> <tr> <td>7</td> <td>7-12</td> <td>Purchase made 6 months or before (Churn state)</td> </tr> </tbody> </table> <p>Similarly, the state of the customer at the start of each month is: </p> <table class=table style="margin-left: auto; margin-right: auto;"> <caption>States after every month</caption> <thead> <tr> <th style=text-align:center;> CustomerID </th> <th style=text-align:center;> recent_purchase_date </th> <th style=text-align:center;> Class1 </th> <th style=text-align:center;> Class2 </th> <th style=text-align:center;> Class3 </th> <th style=text-align:center;> Class4 </th> <th style=text-align:center;> Class5 </th> <th style=text-align:center;> Class6 </th> </tr> </thead> <tbody> <tr> <td style=text-align:center;> 13831 </td> <td style=text-align:center;> 2011-05-23 13:25:00 </td> <td style=text-align:center;> 2 </td> <td style=text-align:center;> 1 </td> <td style=text-align:center;> 2 </td> <td style=text-align:center;> 1 </td> <td style=text-align:center;> 2 </td> <td style=text-align:center;> 1 </td> </tr> <tr> <td style=text-align:center;> 12779 </td> <td style=text-align:center;> 2011-06-03 10:37:00 </td> <td style=text-align:center;> 1 </td> <td style=text-align:center;> 2 </td> <td style=text-align:center;> 3 </td> <td style=text-align:center;> 4 </td> <td style=text-align:center;> 5 </td> <td style=text-align:center;> 1 </td> </tr> <tr> <td style=text-align:center;> 17519 </td> <td style=text-align:center;> 2011-06-19 13:55:00 </td> <td style=text-align:center;> 1 </td> <td style=text-align:center;> 1 </td> <td style=text-align:center;> 2 </td> <td style=text-align:center;> 3 </td> <td style=text-align:center;> 4 </td> <td style=text-align:center;> 1 </td> </tr> <tr> <td style=text-align:center;> 12434 </td> <td style=text-align:center;> 2011-04-04 09:57:00 </td> <td style=text-align:center;> 3 </td> <td style=text-align:center;> 4 </td> <td style=text-align:center;> 5 </td> <td style=text-align:center;> 1 </td> <td style=text-align:center;> 2 </td> <td style=text-align:center;> 3 </td> </tr> <tr> <td style=text-align:center;> 13021 </td> <td style=text-align:center;> 2011-06-26 11:53:00 </td> <td style=text-align:center;> 1 </td> <td style=text-align:center;> 1 </td> <td style=text-align:center;> 2 </td> <td style=text-align:center;> 1 </td> <td style=text-align:center;> 2 </td> <td style=text-align:center;> 1 </td> </tr> <tr> <td style=text-align:center;> 17860 </td> <td style=text-align:center;> 2010-12-06 12:41:00 </td> <td style=text-align:center;> 7 </td> <td style=text-align:center;> 7 </td> <td style=text-align:center;> 7 </td> <td style=text-align:center;> 7 </td> <td style=text-align:center;> 7 </td> <td style=text-align:center;> 7 </td> </tr> <tr> <td style=text-align:center;> 12585 </td> <td style=text-align:center;> 2011-04-19 13:39:00 </td> <td style=text-align:center;> 3 </td> <td style=text-align:center;> 4 </td> <td style=text-align:center;> 5 </td> <td style=text-align:center;> 6 </td> <td style=text-align:center;> 7 </td> <td style=text-align:center;> 7 </td> </tr> <tr> <td style=text-align:center;> 16995 </td> <td style=text-align:center;> 2010-12-02 17:09:00 </td> <td style=text-align:center;> 7 </td> <td style=text-align:center;> 7 </td> <td style=text-align:center;> 7 </td> <td style=text-align:center;> 7 </td> <td style=text-align:center;> 7 </td> <td style=text-align:center;> 7 </td> </tr> <tr> <td style=text-align:center;> 14911 </td> <td style=text-align:center;> 2011-06-30 15:46:00 </td> <td style=text-align:center;> 1 </td> <td style=text-align:center;> 1 </td> <td style=text-align:center;> 1 </td> <td style=text-align:center;> 1 </td> <td style=text-align:center;> 1 </td> <td style=text-align:center;> 1 </td> </tr> <tr> <td style=text-align:center;> 15350 </td> <td style=text-align:center;> 2010-12-01 13:33:00 </td> <td style=text-align:center;> 7 </td> <td style=text-align:center;> 7 </td> <td style=text-align:center;> 7 </td> <td style=text-align:center;> 7 </td> <td style=text-align:center;> 7 </td> <td style=text-align:center;> 7 </td> </tr> </tbody> </table> <p>I can observe that every customer moves from one class (state) to another state every month (step). According to Markov, the probability of a customer to move to state <strong>j</strong> at any step is only given by the previous state <strong>i</strong>. $$ P_{ij} = P(X_{t+1} = j | X_{t} = i) $$ For each interaction (Class1 to Class 2, month 2 to month 3, Step 3 to step 4), a transaction matrix can be created which has the probability of moving from <strong>i</strong> the state to <strong>j</strong> state.</p> <p>But before I can create the one-step transition probabilities, I need to check whether the sequence of random variables can be approximated to a Markov chain. This is carried out using Anderson−Goodman test which is a chi-square test of independence. <br> The null and alternative hypotheses to check whether the sequence of random variables follows a Markov chain is stated below: <br> <span class=arithmatex>\(H_0\)</span>: The sequences of transitions (<span class=arithmatex>\(X_1, X_2, …, X_n\)</span>) are independent (zero-order Markov chain) <br> <span class=arithmatex>\(H_A\)</span>: The sequences of transitions (<span class=arithmatex>\(X_1, X_2, …, X_n\)</span>) are dependent (first-order Markov chain)<br> The corresponding test statistic is $$ \chi^2 = \sum_{i} \sum_{j} (\frac{(O_{ij} -E_{ij})^2}{E_{jj}}) $$</p> <p>The transition probability matrix for the transition form State 1 to 2 is:</p> <div class=highlight><pre><span></span><code><span class=n>seq_matr</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>markovchainFit</span><span class=p>(</span><span class=n>final_classes</span><span class=p>[</span><span class=m>3</span><span class=o>:</span><span class=m>4</span><span class=p>],</span><span class=w> </span><span class=n>method</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;mle&quot;</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#39;CLV&#39;</span><span class=p>)</span>
<span class=n>seq_matr</span><span class=o>$</span><span class=n>estimate</span>
</code></pre></div> <p><div class=highlight><pre><span></span><code>## CLV 
##  A  7 - dimensional discrete Markov Chain defined by the following states: 
##  1, 2, 3, 4, 5, 6, 7 
##  The transition matrix  (by rows)  is defined as follows: 
##            1         2         3    4         5         6         7
## 1 0.57777778 0.4222222 0.0000000 0.00 0.0000000 0.0000000 0.0000000
## 2 0.42957746 0.0000000 0.5704225 0.00 0.0000000 0.0000000 0.0000000
## 3 0.32000000 0.0000000 0.0000000 0.68 0.0000000 0.0000000 0.0000000
## 4 0.13461538 0.0000000 0.0000000 0.00 0.8653846 0.0000000 0.0000000
## 5 0.18181818 0.0000000 0.0000000 0.00 0.0000000 0.8181818 0.0000000
## 6 0.08333333 0.0000000 0.0000000 0.00 0.0000000 0.0000000 0.9166667
## 7 0.10800000 0.0000000 0.0000000 0.00 0.0000000 0.0000000 0.8920000
</code></pre></div> From the above matrix, P(4,5) = 0.8684211 means that the probability of moving from State 4 to State 5 is 86%. That means that a customer who has not purchased any item in 3 months has an 86% probability of not purchasing any item the next month also. </p> <p>Similarly, the Transition matrix for all the steps is:</p> <div class=highlight><pre><span></span><code><span class=n>sequenceMatr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>list</span><span class=p>()</span>
<span class=kr>for</span><span class=p>(</span><span class=n>i</span><span class=w> </span><span class=kr>in</span><span class=w> </span><span class=m>1</span><span class=o>:</span><span class=m>5</span><span class=p>){</span>
<span class=w>  </span><span class=n>sequenceMatr</span><span class=p>[[</span><span class=n>i</span><span class=p>]]</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>markovchainFit</span><span class=p>(</span><span class=n>final_classes</span><span class=p>[(</span><span class=m>2</span><span class=o>+</span><span class=n>i</span><span class=p>)</span><span class=o>:</span><span class=p>(</span><span class=m>3</span><span class=o>+</span><span class=n>i</span><span class=p>)],</span><span class=w> </span><span class=n>method</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;map&quot;</span><span class=p>)</span><span class=o>$</span><span class=n>estimate</span><span class=o>@</span><span class=n>transitionMatrix</span>
<span class=p>}</span>
<span class=n>sequenceMatr</span>
</code></pre></div> <div class=highlight><pre><span></span><code>## [[1]]
##            1         2         3    4         5         6         7
## 1 0.57777778 0.4222222 0.0000000 0.00 0.0000000 0.0000000 0.0000000
## 2 0.42957746 0.0000000 0.5704225 0.00 0.0000000 0.0000000 0.0000000
## 3 0.32000000 0.0000000 0.0000000 0.68 0.0000000 0.0000000 0.0000000
## 4 0.13461538 0.0000000 0.0000000 0.00 0.8653846 0.0000000 0.0000000
## 5 0.18181818 0.0000000 0.0000000 0.00 0.0000000 0.8181818 0.0000000
## 6 0.08333333 0.0000000 0.0000000 0.00 0.0000000 0.0000000 0.9166667
## 7 0.10800000 0.0000000 0.0000000 0.00 0.0000000 0.0000000 0.8920000
## 
## [[2]]
##            1         2         3         4         5         6         7
## 1 0.61309524 0.3869048 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000
## 2 0.36184211 0.0000000 0.6381579 0.0000000 0.0000000 0.0000000 0.0000000
## 3 0.39506173 0.0000000 0.0000000 0.6049383 0.0000000 0.0000000 0.0000000
## 4 0.13725490 0.0000000 0.0000000 0.0000000 0.8627451 0.0000000 0.0000000
## 5 0.22222222 0.0000000 0.0000000 0.0000000 0.0000000 0.7777778 0.0000000
## 6 0.11111111 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.8888889
## 7 0.08984375 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.9101562
## 
## [[3]]
##           1         2         3         4         5         6         7
## 1 0.6220238 0.3779762 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000
## 2 0.4769231 0.0000000 0.5230769 0.0000000 0.0000000 0.0000000 0.0000000
## 3 0.4020619 0.0000000 0.0000000 0.5979381 0.0000000 0.0000000 0.0000000
## 4 0.3877551 0.0000000 0.0000000 0.0000000 0.6122449 0.0000000 0.0000000
## 5 0.2727273 0.0000000 0.0000000 0.0000000 0.0000000 0.7272727 0.0000000
## 6 0.2000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.8000000
## 7 0.1011673 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.8988327
## 
## [[4]]
##           1         2         3         4         5         6         7
## 1 0.5828877 0.4171123 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000
## 2 0.4566929 0.0000000 0.5433071 0.0000000 0.0000000 0.0000000 0.0000000
## 3 0.3823529 0.0000000 0.0000000 0.6176471 0.0000000 0.0000000 0.0000000
## 4 0.2586207 0.0000000 0.0000000 0.0000000 0.7413793 0.0000000 0.0000000
## 5 0.1333333 0.0000000 0.0000000 0.0000000 0.0000000 0.8666667 0.0000000
## 6 0.1875000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.8125000
## 7 0.1042471 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.8957529
## 
## [[5]]
##           1         2         3         4         5         6         7
## 1 0.7118644 0.2881356 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000
## 2 0.6666667 0.0000000 0.3333333 0.0000000 0.0000000 0.0000000 0.0000000
## 3 0.4492754 0.0000000 0.0000000 0.5507246 0.0000000 0.0000000 0.0000000
## 4 0.3095238 0.0000000 0.0000000 0.0000000 0.6904762 0.0000000 0.0000000
## 5 0.2790698 0.0000000 0.0000000 0.0000000 0.0000000 0.7209302 0.0000000
## 6 0.2307692 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.7692308
## 7 0.2170543 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.7829457
</code></pre></div> <p>The Transition Probabilities at various steps seem to follow a pattern. I can do a likelihood ratio test to test the homogeneity of transition matrices. That means I want to find out if the changes in TP across time are random, and I can take a constant TP to describe the different TP's or not. <br> The Null and alternative hypothesis is:<br> <span class=arithmatex>\(H_0 : P_{ij} (t) = P_{ij}\)</span><br> <span class=arithmatex>\(H_1 : P_{ij} (t) \neq P_{ij}\)</span> </p> <p>The test statistic for a likelihood ratio test (Chi-square test) is given by $$ \chi^2 = \sum_{t} \sum_{i} \sum_{j} \frac{n(t)[\hat P_{ij}(t)-\hat P_{ij}]^2}{\hat P_{ij}} $$ where n(t) is the number of customers in state i at time t. The test statistic follows a <span class=arithmatex>\(\chi^2\)</span> distribution with (t − 1) × m × (m − 1) degrees of freedom. </p> <div class=highlight><pre><span></span><code><span class=nf>verifyHomogeneity</span><span class=p>(</span><span class=n>sequenceMatr</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code>## Testing homogeneity of DTMC underlying input list 
## ChiSq statistic is 0.8694698 d.o.f are 192 corresponding p-value is 1
</code></pre></div> <div class=highlight><pre><span></span><code>## $statistic
## [1] 0.8694698
## 
## $dof
## [1] 192
## 
## $pvalue
## [1] 1
</code></pre></div> <p>As the p-value is greater than the <span class=arithmatex>\(\alpha = 0.05\)</span>, I am retaining the Null hypothesis that the transition probabilities are homogeneous. </p> <p>The final TP will be as follows:</p> <div class=highlight><pre><span></span><code><span class=n>finalTP</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=n>sequenceMatr</span><span class=p>[[</span><span class=m>1</span><span class=p>]]</span>
<span class=kr>for</span><span class=p>(</span><span class=n>i</span><span class=w> </span><span class=kr>in</span><span class=w> </span><span class=m>2</span><span class=o>:</span><span class=m>5</span><span class=p>){</span>
<span class=w>  </span><span class=n>finalTP</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=n>finalTP</span><span class=o>+</span><span class=n>sequenceMatr</span><span class=p>[[</span><span class=n>i</span><span class=p>]]</span>
<span class=p>}</span>
<span class=n>finalTP</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=n>finalTP</span><span class=o>/</span><span class=m>5</span>
<span class=n>CLT.mc</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>new</span><span class=p>(</span><span class=s>&#39;markovchain&#39;</span><span class=p>,</span><span class=w> </span>
<span class=w>                  </span><span class=c1># states = colnames(finalTP),</span>
<span class=w>                  </span><span class=n>transitionMatrix</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>finalTP</span><span class=p>,</span>
<span class=w>                  </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#39;CLT&#39;</span><span class=p>)</span>
<span class=n>CLT.mc</span>
</code></pre></div> <div class=highlight><pre><span></span><code>## CLT 
##  A  7 - dimensional discrete Markov Chain defined by the following states: 
##  1, 2, 3, 4, 5, 6, 7 
##  The transition matrix  (by rows)  is defined as follows: 
##           1         2         3         4        5         6         7
## 1 0.6215298 0.3784702 0.0000000 0.0000000 0.000000 0.0000000 0.0000000
## 2 0.4783404 0.0000000 0.5216596 0.0000000 0.000000 0.0000000 0.0000000
## 3 0.3897504 0.0000000 0.0000000 0.6102496 0.000000 0.0000000 0.0000000
## 4 0.2455540 0.0000000 0.0000000 0.0000000 0.754446 0.0000000 0.0000000
## 5 0.2178342 0.0000000 0.0000000 0.0000000 0.000000 0.7821658 0.0000000
## 6 0.1625427 0.0000000 0.0000000 0.0000000 0.000000 0.0000000 0.8374573
## 7 0.1240625 0.0000000 0.0000000 0.0000000 0.000000 0.0000000 0.8759375
</code></pre></div> <p>The Markov chain can be visualized as follows: </p> <div class=highlight><pre><span></span><code><span class=nf>plotmat</span><span class=p>(</span><span class=nf>t</span><span class=p>(</span><span class=n>CLT.mc</span><span class=o>@</span><span class=n>transitionMatrix</span><span class=p>),</span><span class=w> </span><span class=n>box.size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>0.05</span><span class=p>)</span>
</code></pre></div> <p><img alt src=../CustomerLifetimeValue_files/figure-html/plotmap-1.png><!-- --></p> <p>The initial frequency of the classes are: </p> <div class=highlight><pre><span></span><code><span class=n>initial_freq</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=p>(</span><span class=n>final_classes</span><span class=w> </span><span class=o>%&gt;%</span><span class=w> </span><span class=nf>group_by</span><span class=p>(</span><span class=n>Class1</span><span class=p>)</span><span class=w> </span><span class=o>%&gt;%</span><span class=w> </span><span class=nf>summarise</span><span class=p>(</span><span class=n>frequency</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>n</span><span class=p>()</span><span class=o>/</span><span class=nf>nrow</span><span class=p>(</span><span class=n>final_classes</span><span class=p>)))</span><span class=o>$</span><span class=n>frequency</span>
<span class=n>initial_freq</span>
</code></pre></div> <div class=highlight><pre><span></span><code>## [1] 0.37974684 0.14978903 0.07911392 0.05485232 0.03481013 0.03797468 0.26371308
</code></pre></div> <p>As TP is the transition probability between states, I can find the number of people in each state at any time <em>t</em> using the following formula:</p> <div class=arithmatex>\[ u^{(n)} = uP^{(n)} \]</div> <p>From the TP, the frequency in the first stage is compared with the actual frequency at the 1<sup>st</sup> stage. </p> <div class=highlight><pre><span></span><code>## # A tibble: 7 x 3
##   Class2 actual_frequency predicted_frequency
##    &lt;dbl&gt;            &lt;dbl&gt;               &lt;dbl&gt;
## 1      1           0.354               0.236 
## 2      2           0.160               0.0567
## 3      3           0.0854              0     
## 4      4           0.0538              0     
## 5      5           0.0475              0     
## 6      6           0.0285              0     
## 7      7           0.270               0
</code></pre></div> <p>Similarly, for 3<sup>rd</sup> stage</p> <div class=highlight><pre><span></span><code>## # A tibble: 7 x 3
##   Class4 actual_frequency predicted_frequency
##    &lt;dbl&gt;            &lt;dbl&gt;               &lt;dbl&gt;
## 1      1           0.395               0.409 
## 2      2           0.134               0.153 
## 3      3           0.0717              0.0787
## 4      4           0.0612              0.0458
## 5      5           0.0316              0.0360
## 6      6           0.0338              0.0285
## 7      7           0.273               0.249
</code></pre></div> <p>I can observe that a Markov chain can be used to find the number of people in each state after each stage. So the probability of people in each class after n steps is given below:</p> <div class=highlight><pre><span></span><code>## [1] &quot;n = 1&quot;
##              1         2          3          4          5          6         7
## [1,] 0.3984503 0.1437229 0.07813888 0.04827924 0.04138312 0.02722729 0.2627984
## [1] &quot;n = 14&quot;
##              1         2          3          4         5          6         7
## [1,] 0.4260002 0.1610742 0.08392567 0.05113945 0.0385104 0.03005181 0.2092984
## [1] &quot;n = 34&quot;
##             1         2          3          4          5          6         7
## [1,] 0.427639 0.1618467 0.08442764 0.05152099 0.03886892 0.03040108 0.2052957
## [1] &quot;n = 39&quot;
##              1         2          3          4          5        6         7
## [1,] 0.4276527 0.1618532 0.08443183 0.05152418 0.03887192 0.030404 0.2052623
## [1] &quot;n = 43&quot;
##              1        2          3          4          5          6         7
## [1,] 0.4276567 0.161855 0.08443306 0.05152511 0.03887279 0.03040485 0.2052525
## [1] &quot;n = 51&quot;
##             1         2          3          4          5          6         7
## [1,] 0.427659 0.1618562 0.08443378 0.05152566 0.03887331 0.03040535 0.2052467
## [1] &quot;n = 59&quot;
##              1         2         3          4         5          6         7
## [1,] 0.4276594 0.1618563 0.0844339 0.05152575 0.0388734 0.03040544 0.2052457
## [1] &quot;n = 68&quot;
##              1         2          3          4          5          6         7
## [1,] 0.4276595 0.1618564 0.08443393 0.05152577 0.03887341 0.03040545 0.2052456
## [1] &quot;n = 82&quot;
##              1         2          3          4          5          6         7
## [1,] 0.4276595 0.1618564 0.08443393 0.05152577 0.03887341 0.03040546 0.2052455
## [1] &quot;n = 87&quot;
##              1         2          3          4          5          6         7
## [1,] 0.4276595 0.1618564 0.08443393 0.05152577 0.03887341 0.03040546 0.2052455
</code></pre></div> <p>I can observe that as 'n' is increasing, the frequency of customers is tending towards constant. This constant is called steady state frequency. The steady state probability is :</p> <div class=highlight><pre><span></span><code><span class=n>steady.state.prob</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>steadyStates</span><span class=p>(</span><span class=n>CLT.mc</span><span class=p>)</span>
<span class=n>steady.state.prob</span>
</code></pre></div> <div class=highlight><pre><span></span><code>##              1         2          3          4          5          6         7
## [1,] 0.4276595 0.1618564 0.08443393 0.05152577 0.03887341 0.03040546 0.2052455
</code></pre></div> <p>The probability change with steps can be visualized as below: <img alt src=../CustomerLifetimeValue_files/figure-html/plotting-steady-state-1.png><!-- --></p> <h2 id=customer-lifetime-value_1>Customer Lifetime value<a class=headerlink href=#customer-lifetime-value_1 title="Permanent link">&para;</a></h2> <p>Now that I established that the customer segments can be represented as a Markov chain, I can compute the customer lifetime value.<br> The monetary value at each state is </p> <div class=highlight><pre><span></span><code><span class=n>revenue_in_states</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=n>filtered_data</span><span class=w> </span><span class=o>%&gt;%</span><span class=w> </span><span class=nf>left_join</span><span class=p>(</span><span class=n>final_classes</span><span class=p>,</span><span class=w> </span><span class=n>by</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#39;CustomerID&#39;</span><span class=p>)</span><span class=w> </span><span class=o>%&gt;%</span>
<span class=w>  </span><span class=nf>filter</span><span class=p>(</span><span class=n>InvoiceDate</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=nf>date</span><span class=p>(</span><span class=s>&#39;2011-07-01&#39;</span><span class=p>))</span><span class=w> </span><span class=o>%&gt;%</span>
<span class=w>  </span><span class=n>dplyr</span><span class=o>::</span><span class=nf>select</span><span class=p>(</span><span class=n>Class1</span><span class=p>,</span><span class=w> </span><span class=n>total_sales</span><span class=p>)</span><span class=w> </span><span class=o>%&gt;%</span>
<span class=w>  </span><span class=nf>group_by</span><span class=p>(</span><span class=n>Class1</span><span class=p>)</span><span class=w> </span><span class=o>%&gt;%</span>
<span class=w>  </span><span class=nf>summarise</span><span class=p>(</span><span class=n>avg_revenue</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>mean</span><span class=p>(</span><span class=n>total_sales</span><span class=p>))</span>
<span class=nf>kable</span><span class=p>(</span><span class=n>revenue_in_states</span><span class=p>,</span><span class=w> </span><span class=n>align</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#39;c&#39;</span><span class=p>,</span><span class=w> </span><span class=n>caption</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#39;States after steps&#39;</span><span class=p>)</span><span class=w> </span><span class=o>%&gt;%</span><span class=w> </span>
<span class=w>   </span><span class=nf>kable_styling</span><span class=p>(</span><span class=n>full_width</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=bp>F</span><span class=p>)</span>
</code></pre></div> <table class=table style="margin-left: auto; margin-right: auto;"> <caption>States after steps</caption> <thead> <tr> <th style=text-align:center;> Class1 </th> <th style=text-align:center;> avg_revenue </th> </tr> </thead> <tbody> <tr> <td style=text-align:center;> 1 </td> <td style=text-align:center;> 56.51656 </td> </tr> <tr> <td style=text-align:center;> 2 </td> <td style=text-align:center;> 56.17425 </td> </tr> <tr> <td style=text-align:center;> 3 </td> <td style=text-align:center;> 56.45380 </td> </tr> <tr> <td style=text-align:center;> 4 </td> <td style=text-align:center;> 44.33256 </td> </tr> <tr> <td style=text-align:center;> 5 </td> <td style=text-align:center;> 46.58667 </td> </tr> <tr> <td style=text-align:center;> 6 </td> <td style=text-align:center;> 49.00257 </td> </tr> <tr> <td style=text-align:center;> 7 </td> <td style=text-align:center;> 52.82802 </td> </tr> </tbody> </table> <p>The steady-state retention probability is given by $$ R_t = 1 - \frac{\pi_0(1-P_0)}{1-\pi_0}$$ Where <span class=arithmatex>\(P_{00}\)</span> is the transition probability of the null state (State 7), and <span class=arithmatex>\(\pi_0\)</span> is the steady state distribution of the Null state (State 7). Substituting I get: </p> <div class=highlight><pre><span></span><code>## [1] 0.9679608
</code></pre></div> <p>Similarly Customer lifetime value for 5 periods is given by:<br> $$ CLV = \sum_{t=0}^{5} \frac{P_I×P<sup>t×R}{(1+i)</sup>t} $$ Where PI is the initial distribution of customers in different states, P is the transition probability matrix, R is the reward vector (margin generated in each customer segment). The interest rate is i (discount rate), <span class=arithmatex>\(d = 1 + \frac{1}{1+i}=0.95\)</span> is the discount factor.<br> Substituting, I get:</p> <div class=highlight><pre><span></span><code><span class=n>CLT</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=m>0</span>
<span class=kr>for</span><span class=p>(</span><span class=n>k</span><span class=w> </span><span class=kr>in</span><span class=w> </span><span class=m>0</span><span class=o>:</span><span class=m>5</span><span class=p>){</span>
<span class=w>  </span><span class=n>CLT</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>CLT</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=p>(</span><span class=m>0.95</span><span class=o>^</span><span class=n>k</span><span class=p>)</span><span class=o>*</span><span class=p>(</span><span class=n>initial_freq</span><span class=w> </span><span class=o>%*%</span><span class=w> </span><span class=p>(</span><span class=n>CLT.mc</span><span class=o>@</span><span class=n>transitionMatrix</span><span class=o>^</span><span class=n>k</span><span class=p>)</span><span class=w> </span><span class=o>%*%</span><span class=w> </span><span class=n>revenue_in_states</span><span class=o>$</span><span class=n>avg_revenue</span><span class=p>)</span>
<span class=p>}</span>
<span class=n>CLT</span>
</code></pre></div> <p><div class=highlight><pre><span></span><code>##          [,1]
## [1,] 484.3484
</code></pre></div> Therefore, the customer lifetime value is 484.34.</p> <hr> <h2 id=references>References<a class=headerlink href=#references title="Permanent link">&para;</a></h2> <ol> <li>Business Analytics: The Science of Data-Driven Decision Making <a href=https://www.wileyindia.com/business-analytics-the-science-of-data-driven-decision-making.html>Available</a> </li> <li>Introduction to probability, Charles M. Grinstead and J. Laurie Snell, <a href=http://www.dartmouth.edu/~chance/teaching_aids/books_articles/probability_book/book.html>Available</a> </li> <li>CS294 Markov Chain Monte Carlo: Foundations &amp; Applications (lecture by Prof. Alistair Sinclair in Fall 2009) <a href=https://people.eecs.berkeley.edu/~sinclair/cs294/n2.pdf>Available</a> </li> <li>Computer Science Theory for the Information Age, Spring 2012 (course material) <a href=https://www.cs.cmu.edu/~venkatg/teaching/CStheory-infoage/ >Available</a> </li> <li>Customer Analytics at Flipkart.com <a href=https://hbsp.harvard.edu/product/IMB555-PDF-ENG>Available</a> </li> <li>IIMB BAI Class notes and practice problems </li> </ol> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top data-md-state=hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg> Back to top </a> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../../Python/train_delays/ class="md-footer__link md-footer__link--prev" aria-label="Previous: DBSCAN Clustering (Python)" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> DBSCAN Clustering (Python) </div> </div> </a> <a href=../recommendation-systems/ class="md-footer__link md-footer__link--next" aria-label="Next: Recommendation Systems (R)" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Recommendation Systems (R) </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> <img alt="Creative Commons License" style=border-width:0 src=https://i.creativecommons.org/l/by/4.0/88x31.png> </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-footer-social> <a href=https://github.com/HarshaAsh target=_blank rel=noopener title=github.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://www.linkedin.com/in/sri-harsha-achyuthuni/ target=_blank rel=noopener title=www.linkedin.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> <a href=https://www.instagram.com/harshaash_com/ target=_blank rel=noopener title=www.instagram.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"/></svg> </a> <a href=https://www.facebook.com/sri.harsha.achyuthuni/ target=_blank rel=noopener title=www.facebook.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><path d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "content.tabs.link", "header.autohide", "navigation.sections", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "search": "../../assets/javascripts/workers/search.709b4209.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": null}</script> <script src=../../assets/javascripts/bundle.56838a2c.min.js></script> </body> </html>